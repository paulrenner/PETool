<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PE Fund Manager</title>
    <meta name="description" content="Private Equity Fund Analytics & Management Tool">
  <script type="module" crossorigin>var kt=Object.defineProperty;var At=(t,e,n)=>e in t?kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var L=(t,e,n)=>At(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const h={DB_NAME:"FundsDB",FUNDS_STORE:"funds",FUNDNAMES_STORE:"fundNames",GROUPS_STORE:"groups",DB_VERSION:10,CURRENCY_FORMAT:"en-US",CURRENCY_CODE:"USD",CURRENCY_MIN:-1e12,CURRENCY_MAX:1e12,IRR_MAX_ITERATIONS:1e3,IRR_PRECISION:1e-6,IRR_GUESS:.1,IRR_MIN_RATE:-.99,IRR_MAX_RATE:10,DATE_FORMAT:/^\d{4}-\d{2}-\d{2}$/,DEBOUNCE_FILTER:300,DEBOUNCE_SEARCH:300,DEBOUNCE_INPUT:300,MIN_COLUMN_WIDTH:50,MAX_FILE_SIZE:50*1024*1024,FUND_NAME_MIN_LENGTH:2,FUND_NAME_MAX_LENGTH:100,METRICS_CACHE_TTL:5e3,LAZY_RENDER_TIMELINE:!0,ALLOWED_FUND_NAME_PATTERN:/^[a-zA-Z0-9\s\-_.,&']+$/,MAX_IMPORT_FUNDS:1e4,MAX_IMPORT_GROUPS:1e3,MAX_IMPORT_FUNDNAMES:5e3,MAX_JSON_DEPTH:10,DANGEROUS_KEYS:["__proto__","constructor","prototype"],STORAGE_COLUMN_WIDTHS:"columnWidths",STORAGE_SHOW_TAGS:"showTags",STORAGE_BACKUP_WARNING:"backupWarningShown",STORAGE_LAST_BACKUP:"lastBackupDate",BACKUP_REMINDER_DAYS:30};class Rt{constructor(){L(this,"currentFunds",[]);L(this,"fundNames",new Set);L(this,"fundNameData",new Map);L(this,"groups",[]);L(this,"groupsMap",new Map);L(this,"currentGroupDescendants",null);L(this,"sortColumns",[]);L(this,"currentActionFundId",null);L(this,"currentDetailsFundId",null);L(this,"hasUnsavedChanges",!1);L(this,"isResizingColumn",!1);L(this,"lastMousedownOnResizer",!1);L(this,"metricsCache",new Map);L(this,"groupDescendantsCache",new Map);L(this,"ancestorCache",new Map);L(this,"abortController",null)}getFunds(){return this.currentFunds}getGroups(){return this.groups}clearMetricsCache(){this.metricsCache.clear()}getMetricsFromCache(e,n){const a=`${e}-${n}`,o=this.metricsCache.get(a);return o&&Date.now()-o.timestamp<h.METRICS_CACHE_TTL?o.metrics:null}setMetricsCache(e,n,a){const o=`${e}-${n}`;this.metricsCache.set(o,{metrics:a,timestamp:Date.now()})}setFunds(e){this.currentFunds=e}setGroups(e){this.groups=e,this.groupsMap.clear(),e.forEach(n=>this.groupsMap.set(n.id,n)),this.ancestorCache.clear(),this.groupDescendantsCache.clear()}getGroupByIdSync(e){return this.groupsMap.get(e)}getDirectChildIds(e){const n=[];for(const[a,o]of this.groupsMap)o.parentGroupId===e&&n.push(a);return n}getAncestorIds(e){const n=this.ancestorCache.get(e);if(n)return n;const a=[];let o=e;for(;o!=null;){const s=this.groupsMap.get(o);if(!s)break;a.push(s.id),o=s.parentGroupId}return this.ancestorCache.set(e,a),a}getDescendantIds(e){const n=this.groupDescendantsCache.get(e);if(n)return n;const a=[e];for(const[o,s]of this.groupsMap)if(s.parentGroupId===e){const r=this.getDescendantIds(o);a.push(...r.slice(1)),a.push(o)}return this.groupDescendantsCache.set(e,a),a}clearDescendantCache(){this.groupDescendantsCache.clear()}setUnsavedChanges(e){this.hasUnsavedChanges=e}setFundNames(e){this.fundNames=e}setFundNameData(e){this.fundNameData=e}setSortColumns(e){this.sortColumns=e}setCurrentGroupDescendants(e){this.currentGroupDescendants=e}setCurrentActionFundId(e){this.currentActionFundId=e}setCurrentDetailsFundId(e){this.currentDetailsFundId=e}setIsResizingColumn(e){this.isResizingColumn=e}setLastMousedownOnResizer(e){this.lastMousedownOnResizer=e}setAbortController(e){this.abortController=e}}const m=new Rt;let k=null;function xt(){return new Promise((t,e)=>{const n=indexedDB.open(h.DB_NAME,h.DB_VERSION);n.onerror=()=>e(n.error),n.onsuccess=()=>{k=n.result,t(k)},n.onupgradeneeded=a=>{const o=a.target.result,s=a.oldVersion,r=a.target.transaction;if(!o.objectStoreNames.contains(h.FUNDS_STORE)){const i=o.createObjectStore(h.FUNDS_STORE,{keyPath:"id",autoIncrement:!0});i.createIndex("fundName","fundName",{unique:!1}),i.createIndex("accountNumber","accountNumber",{unique:!1})}if(o.objectStoreNames.contains(h.FUNDNAMES_STORE)||o.createObjectStore(h.FUNDNAMES_STORE,{keyPath:"name"}),!o.objectStoreNames.contains(h.GROUPS_STORE)){const i=o.createObjectStore(h.GROUPS_STORE,{keyPath:"id",autoIncrement:!0});i.createIndex("parentGroupId","parentGroupId",{unique:!1}),i.createIndex("name","name",{unique:!1})}if(console.log(`Database upgrade from v${s} to v${h.DB_VERSION}`),s<6&&s>=5){o.objectStoreNames.contains("tags")&&o.deleteObjectStore("tags");const i=r.objectStore(h.FUNDS_STORE),c=r.objectStore(h.FUNDNAMES_STORE),u=new Map;i.openCursor().onsuccess=function(l){const d=l.target.result;if(d){const f=d.value;f.tags&&Array.isArray(f.tags)&&f.tags.length>0&&(u.has(f.fundName)||u.set(f.fundName,new Set),f.tags.forEach(E=>u.get(f.fundName).add(E))),delete f.tags,d.update(f),d.continue()}else c.getAll().onsuccess=function(f){f.target.result.forEach(y=>{const w=y.name,F=u.has(w)?Array.from(u.get(w)):[];c.put({name:w,tags:F})})}}}if(s===9){if(o.objectStoreNames.contains("investments")&&!o.objectStoreNames.contains("funds")){const i=o.createObjectStore("funds",{keyPath:"id",autoIncrement:!0});i.createIndex("fundName","fundName",{unique:!1}),i.createIndex("accountNumber","accountNumber",{unique:!1});const c=r.objectStore("investments");c.openCursor().onsuccess=function(u){const l=u.target.result;l&&(i.put(l.value),l.continue())}}if(o.objectStoreNames.contains("investmentNames")&&!o.objectStoreNames.contains("fundNames")){o.createObjectStore("fundNames",{keyPath:"name"});const i=r.objectStore("investmentNames"),c=r.objectStore("fundNames");i.openCursor().onsuccess=function(u){const l=u.target.result;l&&(c.put(l.value),l.continue())}}o.objectStoreNames.contains("investments")&&o.deleteObjectStore("investments"),o.objectStoreNames.contains("investmentNames")&&o.deleteObjectStore("investmentNames")}}})}async function Re(t,e,n){if(!k)throw new Error("Database not initialized");return new Promise((a,o)=>{const r=k.transaction([t],e).objectStore(t),i=n(r);i.onsuccess=()=>a(i.result),i.onerror=()=>o(i.error)})}function K(t){return new Promise((e,n)=>{if(!k){n(new Error("Database not initialized"));return}const o=k.transaction([h.FUNDS_STORE],"readwrite").objectStore(h.FUNDS_STORE);let s;if(t.id)s=o.put(t);else{const{id:r,...i}=t;s=o.add(i)}s.onsuccess=()=>e(s.result),s.onerror=()=>n(s.error)})}function $(){return Re(h.FUNDS_STORE,"readonly",t=>t.getAll())}function ne(t){return Re(h.FUNDS_STORE,"readonly",e=>e.get(t))}function dt(t){return new Promise((e,n)=>{if(!k){n(new Error("Database not initialized"));return}const s=k.transaction([h.FUNDS_STORE],"readwrite").objectStore(h.FUNDS_STORE).delete(t);s.onsuccess=()=>e(),s.onerror=()=>n(s.error)})}function ge(){return new Promise((t,e)=>{if(!k){e(new Error("Database not initialized"));return}const o=k.transaction([h.FUNDNAMES_STORE],"readonly").objectStore(h.FUNDNAMES_STORE).getAll();o.onsuccess=()=>{const s=o.result.map(r=>({name:r.name,tags:r.tags||[],investmentTermStartDate:r.investmentTermStartDate||r.finalCloseDate||null,investmentTermYears:r.investmentTermYears||null}));t(s)},o.onerror=()=>e(o.error)})}function ce(t){return new Promise((e,n)=>{if(!k){n(new Error("Database not initialized"));return}const a=typeof t=="string"?{name:t,tags:[],investmentTermStartDate:null,investmentTermYears:null}:{name:t.name,tags:t.tags||[],investmentTermStartDate:t.investmentTermStartDate||null,investmentTermYears:t.investmentTermYears||null},r=k.transaction([h.FUNDNAMES_STORE],"readwrite").objectStore(h.FUNDNAMES_STORE).put(a);r.onsuccess=()=>e(),r.onerror=()=>n(r.error)})}function mt(t){return new Promise((e,n)=>{if(!k){n(new Error("Database not initialized"));return}const s=k.transaction([h.FUNDNAMES_STORE],"readwrite").objectStore(h.FUNDNAMES_STORE).delete(t);s.onsuccess=()=>e(),s.onerror=()=>n(s.error)})}function Q(){return Re(h.GROUPS_STORE,"readonly",t=>t.getAll())}function xe(t){return new Promise((e,n)=>{if(!k){n(new Error("Database not initialized"));return}const s=k.transaction([h.GROUPS_STORE],"readwrite").objectStore(h.GROUPS_STORE).put(t);s.onsuccess=()=>e(s.result),s.onerror=()=>n(s.error)})}function Lt(t){return new Promise((e,n)=>{if(!k){n(new Error("Database not initialized"));return}const s=k.transaction([h.GROUPS_STORE],"readwrite").objectStore(h.GROUPS_STORE).delete(t);s.onsuccess=()=>e(),s.onerror=()=>n(s.error)})}function Gt(){return new Promise((t,e)=>{if(!k){e(new Error("Database not initialized"));return}const n=k.transaction([h.FUNDS_STORE,h.FUNDNAMES_STORE,h.GROUPS_STORE],"readwrite");let a=0;const o=[h.FUNDS_STORE,h.FUNDNAMES_STORE,h.GROUPS_STORE];o.forEach(s=>{const i=n.objectStore(s).clear();i.onsuccess=()=>{a++,a===o.length&&t()},i.onerror=()=>e(i.error)})})}function ft(t,e=h.IRR_GUESS){if(!Array.isArray(t)||t.length<2)return null;const n=[...t].sort((i,c)=>new Date(i.date).getTime()-new Date(c.date).getTime()),a=new Date(n[0].date),o=i=>n.reduce((c,u)=>{const l=(new Date(u.date).getTime()-a.getTime())/315576e5;return c+u.amount/Math.pow(1+i,l)},0),s=i=>n.reduce((c,u)=>{const l=(new Date(u.date).getTime()-a.getTime())/315576e5;return l===0?c:c-l*u.amount/Math.pow(1+i,l+1)},0);let r=e;for(let i=0;i<h.IRR_MAX_ITERATIONS;i++){const c=o(r),u=s(r);if(Math.abs(c)<h.IRR_PRECISION)return r>h.IRR_MAX_RATE||r<h.IRR_MIN_RATE?null:r;if(Math.abs(u)<h.IRR_PRECISION)return null;const l=r-c/u;if(Math.abs(l-r)<h.IRR_PRECISION)return l>h.IRR_MAX_RATE||l<h.IRR_MIN_RATE?null:l;r=l}return null}function pt(t){if(!Array.isArray(t)||t.length===0)return null;const e=t.filter(a=>a.amount<0).reduce((a,o)=>a+Math.abs(o.amount),0),n=t.filter(a=>a.amount>0).reduce((a,o)=>a+o.amount,0);return e===0?null:n/e}function ee(t){if(typeof t!="string"||!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;const e=new Date(t);if(isNaN(e.getTime()))return!1;const[n,a,o]=t.split("-").map(Number);return e.getFullYear()===n&&e.getMonth()+1===a&&e.getDate()===o}function O(t){if(t===null||typeof t>"u")return NaN;if(typeof t=="number")return isFinite(t)?t:NaN;if(typeof t=="string"){const e=t.replace(/[$,]/g,"").replace(/^\((.*)\)$/,"-$1").trim();if(e==="")return NaN;const n=parseFloat(e);return isFinite(n)?n:NaN}return NaN}function Ne(t){if(t==null||isNaN(t))return"";const e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}function B(t,e=!1){const n=typeof t=="string"?parseFloat(t):t;return!isFinite(n)||isNaN(n)?"$0":n.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:e?2:0,maximumFractionDigits:e?2:0})}function Ce(t){const e=(t.cashFlows||[]).filter(n=>n.type==="Contribution"&&ee(n.date)).sort((n,a)=>new Date(n.date).getTime()-new Date(a.date).getTime());return e.length>0?new Date(e[0].date).getFullYear():null}function ct(t,e,n){return(t.cashFlows||[]).filter(a=>a.type===e&&ee(a.date)&&(!n||new Date(a.date)<=n)).reduce((a,o)=>a+Math.abs(O(o.amount)||0),0)}function gt(t,e){const n=(t.monthlyNav||[]).filter(i=>ee(i.date)&&(!e||new Date(i.date)<=e)).sort((i,c)=>new Date(c.date).getTime()-new Date(i.date).getTime());if(n.length===0)return 0;const a=n[0];let o=O(a.amount)||0;const s=new Date(a.date);return(t.cashFlows||[]).filter(i=>{if(!ee(i.date))return!1;const c=new Date(i.date);return c>s&&(!e||c<=e)}).forEach(i=>{const c=O(i.amount)||0;i.type==="Contribution"?o-=Math.abs(c):i.type==="Distribution"&&(o+=Math.abs(c))}),o}function Ot(t,e){const n=(t.monthlyNav||[]).filter(a=>ee(a.date)&&(!e||new Date(a.date)<=e)).sort((a,o)=>new Date(o.date).getTime()-new Date(a.date).getTime());return n.length>0?n[0].date:null}function $t(t,e){let n=O(t.commitment)||0;return(t.cashFlows||[]).filter(a=>ee(a.date)&&(!e||new Date(a.date)<=e)&&a.affectsCommitment!==!1).forEach(a=>{if(a.type==="Contribution"){const o=O(a.amount)||0;n-=Math.abs(o)}else if(a.type==="Distribution"){const o=O(a.amount)||0;n+=Math.abs(o)}}),Math.max(0,n)}function yt(t,e){const n=(t.cashFlows||[]).filter(o=>ee(o.date)&&(!e||new Date(o.date)<=e)&&o.type!=="Adjustment").map(o=>{const s=O(o.amount)||0;return{date:o.date,amount:o.type==="Contribution"?-Math.abs(s):Math.abs(s)}}),a=gt(t,e);if(a>=0){const o=(t.monthlyNav||[]).filter(s=>ee(s.date)&&(!e||new Date(s.date)<=e)).sort((s,r)=>new Date(r.date).getTime()-new Date(s.date).getTime());o.length>0&&n.push({date:o[0].date,amount:a})}return n.sort((o,s)=>new Date(o.date).getTime()-new Date(s.date).getTime())}function pe(t,e){const n=O(t.commitment)||0,a=ct(t,"Contribution",e),o=ct(t,"Distribution",e),s=gt(t,e),r=Ot(t,e),i=$t(t,e),c=Ce(t),u=o+s-a,l=yt(t,e),d=ft(l),f=pt(l),E=a>0?o/a:null,y=a>0?s/a:null,w=a>0?(o+s)/a:null;return{calledCapital:a,distributions:o,nav:s,navDate:r,irr:d,moic:f,dpi:E,rvpi:y,tvpi:w,outstandingCommitment:i,vintageYear:c,commitment:n,totalContributions:a,totalDistributions:o,investmentReturn:u,vintage:c}}function M(t){if(typeof t!="string")return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}function Te(t){if(t==null)return"";const e=String(t);return e.includes(",")||e.includes('"')||e.includes(`
`)?'"'+e.replace(/"/g,'""')+'"':e}function Le(t){return t==null||!isFinite(t)?"N/A":t.toFixed(2)+"x"}function Ge(t){return t==null||!isFinite(t)?"N/A":(t*100).toFixed(2)+"%"}function ht(t){if(!t.groupId)return"";const e=m.getGroupByIdSync(t.groupId);return e?e.name:""}function Me(t){const e=ht(t);return e?`${e} (${t.accountNumber})`:t.accountNumber}function _t(t){const e=ht(t);return e?`<div>${M(e)}</div><div style="font-size: 0.85em; color: var(--color-text-light);">${M(t.accountNumber)}</div>`:M(t.accountNumber)}function vt(t,e){return e.length===0?t:[...t].sort((n,a)=>{for(const{column:o,direction:s}of e){const r=s==="asc"?1:-1;let i=0;const c=pe(n),u=pe(a);switch(o){case"fundName":i=n.fundName.localeCompare(a.fundName);break;case"accountNumber":i=Me(n).localeCompare(Me(a));break;case"vintage":const l=c.vintageYear||0,d=u.vintageYear||0;i=l-d;break;case"commitment":i=(c.commitment||0)-(u.commitment||0);break;case"totalContributions":i=(c.calledCapital||0)-(u.calledCapital||0);break;case"totalDistributions":i=(c.distributions||0)-(u.distributions||0);break;case"nav":i=(c.nav||0)-(u.nav||0);break;case"investmentReturn":i=(c.investmentReturn||0)-(u.investmentReturn||0);break;case"moic":i=(c.moic||0)-(u.moic||0);break;case"irr":i=(c.irr||0)-(u.irr||0);break;case"outstandingCommitment":i=(c.outstandingCommitment||0)-(u.outstandingCommitment||0);break;default:i=0}if(i!==0)return i*r}return 0})}function Pt(t,e,n=!1){const a=t.metrics,o=m.fundNameData.get(t.fundName),s=o&&o.tags?o.tags:[],r=n&&s.length>0?`<div class="table-tags">${s.map(c=>`<span class="table-tag">${M(c)}</span>`).join("")}</div>`:"",i=a.investmentReturn??a.distributions+a.nav-a.calledCapital;return`
    <td>
      <div>${M(t.fundName)}</div>
      ${r}
    </td>
    <td title="${M(Me(t))}">${_t(t)}</td>
    <td class="center">${a.vintageYear||"N/A"}</td>
    <td class="number">${B(a.commitment||0)}</td>
    <td class="number">${B(a.calledCapital)}</td>
    <td class="number">${B(a.distributions)}</td>
    <td class="number">${B(a.nav)}</td>
    <td class="number ${i>=0?"positive":"negative"}">${B(i)}</td>
    <td class="number">${Le(a.moic)}</td>
    <td class="number ${a.irr!==null&&a.irr>=0?"positive":"negative"}">${Ge(a.irr)}</td>
    <td class="number">${B(a.outstandingCommitment)}</td>
    <td class="center">
      <button class="btn-icon fund-actions-btn" data-fund-id="${t.id}" title="Actions" aria-label="Actions for ${M(t.fundName)}">⚙</button>
    </td>
  `}function Et(t,e){const n={commitment:0,calledCapital:0,distributions:0,nav:0,investmentReturn:0,outstandingCommitment:0,aggregateFlows:[]};t.forEach(c=>{const u=c.metrics;n.commitment+=u.commitment||0,n.calledCapital+=u.calledCapital,n.distributions+=u.distributions,n.nav+=u.nav,n.investmentReturn+=u.investmentReturn??u.distributions+u.nav-u.calledCapital,n.outstandingCommitment+=u.outstandingCommitment;const l=yt(c,e);n.aggregateFlows.push(...l)});const a=ft(n.aggregateFlows),o=pt(n.aggregateFlows),s=n.calledCapital>0?n.distributions/n.calledCapital:null,r=n.calledCapital>0?n.nav/n.calledCapital:null,i=n.calledCapital>0?(n.distributions+n.nav)/n.calledCapital:null;return{commitment:n.commitment,calledCapital:n.calledCapital,distributions:n.distributions,nav:n.nav,investmentReturn:n.investmentReturn,outstandingCommitment:n.outstandingCommitment,aggregateIRR:a,aggregateMOIC:o,aggregateDPI:s,aggregateRVPI:r,aggregateTVPI:i}}function Ut(t){return`
    <td><strong>Total</strong></td>
    <td></td>
    <td></td>
    <td class="number"><strong>${B(t.commitment)}</strong></td>
    <td class="number"><strong>${B(t.calledCapital)}</strong></td>
    <td class="number"><strong>${B(t.distributions)}</strong></td>
    <td class="number"><strong>${B(t.nav)}</strong></td>
    <td class="number ${t.investmentReturn>=0?"positive":"negative"}"><strong>${B(t.investmentReturn)}</strong></td>
    <td class="number"><strong>${Le(t.aggregateMOIC)}</strong></td>
    <td class="number ${t.aggregateIRR!==null&&t.aggregateIRR>=0?"positive":"negative"}"><strong>${Ge(t.aggregateIRR)}</strong></td>
    <td class="number"><strong>${B(t.outstandingCommitment)}</strong></td>
    <td></td>
  `}function qt(t,e){const n=Et(t,e),a=new Set(t.map(s=>s.fundName)),o=(s,r)=>{const i=document.getElementById(s);i&&(i.textContent=r)};o("summaryInvestmentCount",t.length.toString()),o("summaryFundCount",a.size.toString()),o("summaryCommitment",B(n.commitment)),o("summaryNav",B(n.nav)),o("summaryIRR",Ge(n.aggregateIRR)),o("summaryMOIC",Le(n.aggregateMOIC)),o("summaryDPI",n.aggregateDPI!==null?n.aggregateDPI.toFixed(2)+"x":"N/A"),o("summaryRVPI",n.aggregateRVPI!==null?n.aggregateRVPI.toFixed(2)+"x":"N/A"),o("summaryTVPI",n.aggregateTVPI!==null?n.aggregateTVPI.toFixed(2)+"x":"N/A")}function Vt(t){document.querySelectorAll("#fundsTable th").forEach(e=>{e.classList.remove("sort-asc","sort-desc");const n=e.querySelector(".sort-indicator");n&&n.remove()}),t.forEach(({column:e,direction:n},a)=>{const o=document.querySelector(`#fundsTable th[data-sort="${e}"]`);if(o){o.classList.add(n==="asc"?"sort-asc":"sort-desc");const s=document.createElement("span");s.className="sort-indicator",s.textContent=n==="asc"?" ▲":" ▼",t.length>1&&(s.textContent+=` (${a+1})`),o.appendChild(s)}})}function T(t){const e=document.getElementById(t);if(!e)return[];const n=e.querySelectorAll(".multi-select-option.selected");return Array.from(n).map(a=>a.dataset.value||"")}function jt(t,e){const n=document.getElementById(t);if(!n)return;n.querySelectorAll(".multi-select-option").forEach(o=>{const s=o;if(e.includes(s.dataset.value||"")){o.classList.add("selected");const r=o.querySelector('input[type="checkbox"]');r&&(r.checked=!0)}else{o.classList.remove("selected");const r=o.querySelector('input[type="checkbox"]');r&&(r.checked=!1)}}),Oe(t)}function me(t){jt(t,[])}function Oe(t){const e=document.getElementById(t);if(!e)return;const n=e.querySelector(".multi-select-display");if(!n)return;const a=e.dataset.placeholder||"Select...",o=T(t);if(o.length===0)n.innerHTML=`<span class="placeholder">${M(a)}</span>`;else if(o.length===1){const r=e.querySelector(`.multi-select-option[data-value="${CSS.escape(o[0]||"")}"]`)?.querySelector("label")?.textContent||o[0];n.innerHTML=M(r)}else n.innerHTML=`<span class="multi-select-count">${o.length} selected</span>`}function fe(t,e,n=[]){const a=document.getElementById(t);if(!a)return;const o=a.querySelector(".multi-select-dropdown");if(!o)return;let s=!1;const r=e.map(i=>{const c=n.includes(i.value),u=i.indent!==void 0?`style="--indent-level: ${i.indent}"`:"",l=["multi-select-option"];return i.indent!==void 0&&(i.indent===0?(l.push("group-top-level"),s&&l.push("group-separator"),s=!0):l.push("group-option","group-child")),c&&l.push("selected"),`
      <div class="${l.join(" ")}"
           data-value="${M(i.value)}"
           role="option"
           aria-selected="${c}"
           ${u}>
        <input type="checkbox" ${c?"checked":""} tabindex="-1">
        <label>${M(i.label)}</label>
      </div>
    `}).join("");o.innerHTML=`
    <div class="multi-select-search">
      <input type="text" placeholder="Search..." aria-label="Search options">
    </div>
    <div class="multi-select-options">${r}</div>
    <div class="multi-select-no-results">No matches found</div>
  `,Oe(t)}function It(t,e){const n=t.querySelector(".multi-select-options"),a=t.querySelector(".multi-select-no-results");if(!n)return;const o=n.querySelectorAll(".multi-select-option"),s=e.toLowerCase().trim();let r=0;o.forEach(i=>{const c=i.querySelector("label"),u=c&&c.textContent?.toLowerCase()||"";s===""||u.includes(s)?(i.classList.remove("search-hidden"),r++):i.classList.add("search-hidden")}),a&&a.classList.toggle("visible",r===0&&s!=="")}function be(t){const e=t.querySelector(".multi-select-search input");e&&(e.value=""),It(t,"")}function Fe(t,e){return t.filter(n=>n.parentGroupId===e).map(n=>({...n,children:Fe(t,n.id)}))}const Ht=[{id:"fundFilter",isMultiSelect:!0,apply:(t,e)=>e.length===0||e.includes(t.fundName)},{id:"accountFilter",isMultiSelect:!0,apply:(t,e)=>e.length===0||e.includes(t.accountNumber)},{id:"vintageFilter",isMultiSelect:!0,apply:(t,e)=>{if(e.length===0)return!0;const n=Ce(t);return n!==null&&e.includes(n.toString())}}];function wt(t){const e={fundFilter:T("fundFilter"),accountFilter:T("accountFilter"),groupFilter:T("groupFilter"),tagFilter:T("tagFilter"),vintageFilter:T("vintageFilter")};return t.filter(n=>{for(const s of Ht){const r=e[s.id]||[];if(!s.apply(n,r))return!1}const a=e.groupFilter;if(a.length>0){if(!n.groupId)return!1;let s=!1;for(const r of a){const i=parseInt(r);if(n.groupId===i){s=!0;break}if(m.getDescendantIds(i).includes(n.groupId)){s=!0;break}}if(!s)return!1}const o=e.tagFilter;if(o.length>0){const r=m.fundNameData.get(n.fundName)?.tags||[];if(!o.some(c=>r.includes(c)))return!1}return!0})}function bt(){me("fundFilter"),me("accountFilter"),me("groupFilter"),me("tagFilter"),me("vintageFilter");const t=document.getElementById("cutoffDate");t&&(t.value="")}function Yt(){const t=document.getElementById("activeFiltersIndicator");if(!t)return;const e=[T("fundFilter"),T("accountFilter"),T("groupFilter"),T("tagFilter"),T("vintageFilter")].filter(o=>o.length>0).length,n=document.getElementById("cutoffDate")?.value,a=e+(n?1:0);a>0?(t.textContent=`${a} filter${a>1?"s":""} active`,t.style.display="inline-block"):t.style.display="none"}function zt(t,e,n){const a=t.querySelector(".multi-select-options");if(!a)return;const o=(r,i)=>{const c=a.querySelector(`[data-value="${r}"]`);if(c){i?c.classList.add("selected"):c.classList.remove("selected");const u=c.querySelector('input[type="checkbox"]');u&&(u.checked=i),c.setAttribute("aria-selected",i.toString())}},s=r=>{const i=a.querySelector(`[data-value="${r}"]`);return i?i.classList.contains("selected"):!1};if(n){m.getDescendantIds(e).forEach(c=>{c!==e&&o(c,!0)});let i=e;for(;i!=null;){const c=m.getGroupByIdSync(i);if(!c||c.parentGroupId==null)break;const u=c.parentGroupId;if(m.getDirectChildIds(u).every(f=>s(f)))o(u,!0),i=u;else break}}else{m.getDescendantIds(e).forEach(c=>{c!==e&&o(c,!1)});const i=m.getGroupByIdSync(e);if(i&&i.parentGroupId!=null){let c=i.parentGroupId;for(;c!=null;){o(c,!1);const u=m.getGroupByIdSync(c);c=u?u.parentGroupId:null}}}}function Xt(t){const e=T("groupFilter"),n=T("fundFilter"),a=T("accountFilter"),o=T("vintageFilter"),s=T("tagFilter"),r=(v,b)=>b.length===0?v:v.filter(D=>{if(!D.groupId)return!1;for(const j of b){const H=parseInt(j);if(D.groupId===H||m.getDescendantIds(H).includes(D.groupId))return!0}return!1}),i=(v,b)=>b.length===0?v:v.filter(D=>{const j=Ce(D);return j!==null&&b.includes(j.toString())}),c=(v,b)=>b.length===0?v:v.filter(D=>b.includes(D.fundName)),u=(v,b)=>b.length===0?v:v.filter(D=>b.includes(D.accountNumber));let l=t;l=r(l,e),l=u(l,a),l=i(l,o);const d=[...new Set(l.map(v=>v.fundName))].sort(),f=d.map(v=>({value:v,label:v})),E=n.filter(v=>d.includes(v));fe("fundFilter",f,E);let y=t;y=r(y,e),y=c(y,n),y=i(y,o);const w=[...new Set(y.map(v=>v.accountNumber))].sort(),F=w.map(v=>({value:v,label:v})),C=a.filter(v=>w.includes(v));fe("accountFilter",F,C);const S=m.getGroups(),U=[];if(S.length>0){const v=Fe(S,null),b=(D,j,H=null)=>{const J=[];return D.forEach(z=>{(H===null||H.has(z.id))&&J.push({value:z.id.toString(),label:z.name,indent:j}),z.children&&z.children.length>0&&J.push(...b(z.children,j+1,H))}),J};if(e.length>0)U.push(...b(v,0));else if(n.length>0||a.length>0||o.length>0){let D=t;D=c(D,n),D=u(D,a),D=i(D,o);const j=new Set;D.forEach(H=>{H.groupId!=null&&m.getAncestorIds(H.groupId).forEach(z=>j.add(z))}),U.push(...b(v,0,j))}else U.push(...b(v,0))}const q=e.filter(v=>U.some(b=>b.value===v));fe("groupFilter",U,q);let V=t;V=r(V,e),V=c(V,n),V=u(V,a);const W=new Set;V.forEach(v=>{const b=Ce(v);b!==null&&W.add(b)});const he=Array.from(W).sort((v,b)=>b-v),ve=he.map(v=>({value:v.toString(),label:v.toString()})),ae=o.filter(v=>he.includes(parseInt(v)));fe("vintageFilter",ve,ae);const le=new Set;m.fundNameData.forEach(v=>{v.tags&&v.tags.forEach(b=>le.add(b))});const de=Array.from(le).sort((v,b)=>v.localeCompare(b)),Ee=de.map(v=>({value:v,label:v})),Ie=s.filter(v=>de.includes(v));fe("tagFilter",Ee,Ie)}let St=null,ke=null;function g(t,e="success"){const n=document.createElement("div");n.className=`status-message ${e}`;const a=document.createElement("button");a.className="close-status",a.innerHTML="&times;",a.onclick=()=>n.remove();const o=document.createElement("span");o.textContent=t,n.appendChild(o),n.appendChild(a),document.body.appendChild(n),setTimeout(()=>{n.parentNode&&n.remove()},e==="success"?3e3:8e3)}function _(t="Loading..."){const e=document.getElementById("loadingOverlay"),n=document.getElementById("loadingText");n&&(n.textContent=t),e&&e.classList.add("show")}function A(){const t=document.getElementById("loadingOverlay");t&&t.classList.remove("show")}function re(t,e={}){return new Promise(n=>{const a=document.getElementById("confirmModal"),o=document.getElementById("confirmModalTitle"),s=document.getElementById("confirmModalMessage"),r=document.getElementById("confirmModalConfirmBtn"),i=document.getElementById("confirmModalCancelBtn");if(!a||!o||!s||!r||!i){n(!1);return}o.textContent=e.title||"Confirm",s.textContent=t,r.textContent=e.confirmText||"Confirm",i.textContent=e.cancelText||"Cancel",a.classList.add("show");const c=()=>{a.classList.remove("show"),r.onclick=null,i.onclick=null};r.onclick=()=>{c(),n(!0)},i.onclick=()=>{c(),n(!1)}})}function Y(t){const e=document.getElementById(t);e&&e.classList.add("show")}function R(t){const e=document.getElementById(t);e&&e.classList.remove("show")}async function De(){const t=document.getElementById("fundName");if(!t)return;const e=await ge(),n=e.map(r=>r.name).sort();m.setFundNames(new Set(n));const a=new Map;e.forEach(r=>a.set(r.name,r)),m.setFundNameData(a);const o=t.value;t.innerHTML='<option value="">Select a fund</option>',n.forEach(r=>{const i=document.createElement("option");i.value=r,i.textContent=r,t.appendChild(i)});const s=document.createElement("option");s.value="__new__",s.textContent="+ Add new fund name...",t.appendChild(s),o&&n.includes(o)&&(t.value=o)}function oe(t,e){const n=document.getElementById(t);if(!n)return;const a=m.getGroups(),o=Fe(a,null);n.innerHTML='<option value="">No Group</option>';const s=(r,i)=>{r.forEach(c=>{if(e!==void 0&&c.id===e)return;const u=document.createElement("option");u.value=c.id.toString();const l=i>0?"–".repeat(i)+" ":"";u.textContent=l+c.name,n.appendChild(u),c.children&&c.children.length>0&&s(c.children,i+1)})};s(o,0)}async function Be(){const t=document.getElementById("fundModalTitle"),e=document.getElementById("fundId"),n=document.getElementById("isDuplicate"),a=document.getElementById("saveFundBtn"),o=document.getElementById("duplicateMultiplierContainer");t&&(t.textContent="Add New Investment"),e&&(e.value=""),n&&(n.value=""),a&&(a.textContent="Save"),o&&(o.style.display="none");const s=document.getElementById("fundForm");s&&s.reset(),await De(),oe("fundGroup"),Y("fundModal")}async function Kt(t){const e=await ne(t);if(!e){g("Fund not found","error");return}const n=document.getElementById("fundModalTitle"),a=document.getElementById("fundId"),o=document.getElementById("isDuplicate"),s=document.getElementById("fundName"),r=document.getElementById("accountNumber"),i=document.getElementById("fundGroup"),c=document.getElementById("commitment"),u=document.getElementById("saveFundBtn"),l=document.getElementById("duplicateMultiplierContainer");n&&(n.textContent="Edit Investment"),a&&(a.value=t.toString()),o&&(o.value=""),u&&(u.textContent="Save"),l&&(l.style.display="none"),await De(),oe("fundGroup"),s&&(s.value=e.fundName),r&&(r.value=e.accountNumber),i&&(i.value=e.groupId?.toString()||""),c&&(c.value=Ne(e.commitment)),Y("fundModal")}async function Wt(t){const e=await ne(t);if(!e){g("Fund not found","error");return}const n=document.getElementById("fundModalTitle"),a=document.getElementById("fundId"),o=document.getElementById("isDuplicate"),s=document.getElementById("fundName"),r=document.getElementById("accountNumber"),i=document.getElementById("fundGroup"),c=document.getElementById("commitment"),u=document.getElementById("duplicateMultiplier"),l=document.getElementById("saveFundBtn"),d=document.getElementById("duplicateMultiplierContainer");n&&(n.textContent="Duplicate Investment"),a&&(a.value=t.toString()),o&&(o.value="true"),l&&(l.textContent="Duplicate"),d&&(d.style.display="block"),u&&(u.value="1"),await De(),oe("fundGroup"),s&&(s.value=e.fundName),r&&(r.value=""),i&&(i.value=e.groupId?.toString()||""),c&&(c.value=Ne(e.commitment)),Y("fundModal")}async function Jt(t){const e=document.getElementById("fundId"),n=document.getElementById("isDuplicate"),a=document.getElementById("fundName"),o=document.getElementById("accountNumber"),s=document.getElementById("fundGroup"),r=document.getElementById("commitment"),i=document.getElementById("duplicateMultiplier"),c=a?.value||"",u=o?.value?.trim()||"",l=s?.value?parseInt(s.value):null,d=O(r?.value||"0"),f=n?.value==="true",E=parseFloat(i?.value||"1")||1;if(!c||c==="__new__"){g("Please select a fund name","error");return}if(!u){g("Please enter an account number","error");return}if(isNaN(d)||d<=0){g("Please enter a valid commitment amount","error");return}try{if(_("Saving..."),f&&e?.value){const y=await ne(parseInt(e.value));if(!y){g("Original fund not found","error"),A();return}const w={fundName:c,accountNumber:u,groupId:l,commitment:d*E,cashFlows:y.cashFlows.map(F=>({...F,amount:F.amount*E})),monthlyNav:y.monthlyNav.map(F=>({...F,amount:F.amount*E})),timestamp:new Date().toISOString()};await K(w),g("Investment duplicated successfully")}else if(e?.value){const y=await ne(parseInt(e.value));if(!y){g("Fund not found","error"),A();return}const w={...y,fundName:c,accountNumber:u,groupId:l,commitment:d,timestamp:new Date().toISOString()};await K(w),g("Investment updated successfully")}else{const y={fundName:c,accountNumber:u,groupId:l,commitment:d,cashFlows:[],monthlyNav:[],timestamp:new Date().toISOString()};await K(y),g("Investment added successfully")}R("fundModal"),m.clearMetricsCache(),await t()}catch(y){console.error("Error saving fund:",y),g("Error saving investment: "+y.message,"error")}finally{A()}}async function Zt(t,e){const n=await ne(t);if(!n){g("Fund not found","error");return}if(await re(`Are you sure you want to delete "${n.fundName}" (${n.accountNumber})? This action cannot be undone.`,{title:"Delete Investment",confirmText:"Delete",cancelText:"Cancel"}))try{_("Deleting..."),await dt(t),m.clearMetricsCache(),g("Investment deleted successfully"),await e()}catch(o){console.error("Error deleting fund:",o),g("Error deleting investment: "+o.message,"error")}finally{A()}}async function $e(t,e){const n=await ne(t);if(!n){g("Fund not found","error");return}ke=t;const a=document.getElementById("detailsModalTitle"),o=document.getElementById("detailsModalSubtitle"),s=document.querySelector("#cashFlowsTable tbody"),r=document.querySelector("#navTable tbody");a&&(a.textContent=n.fundName),o&&(o.textContent=n.accountNumber);const i=pe(n),c=(u,l)=>{const d=document.getElementById(u);d&&(d.textContent=l)};c("detailsSummaryCommitment",B(n.commitment)),c("detailsSummaryContributions",B(i.calledCapital)),c("detailsSummaryDistributions",B(i.distributions)),c("detailsSummaryValue",B(i.nav)),c("detailsSummaryReturn",B(i.investmentReturn||0)),c("detailsSummaryOutstanding",B(i.outstandingCommitment)),s&&(s.innerHTML="",[...n.cashFlows].sort((l,d)=>new Date(d.date).getTime()-new Date(l.date).getTime()).forEach((l,d)=>{const f=document.createElement("tr");f.innerHTML=`
        <td><input type="date" value="${l.date}" data-field="date" data-index="${d}"></td>
        <td class="number"><input type="text" value="${Ne(O(l.amount)||0)}" data-field="amount" data-index="${d}"></td>
        <td class="center">
          <select data-field="type" data-index="${d}">
            <option value="Contribution" ${l.type==="Contribution"?"selected":""}>Contribution</option>
            <option value="Distribution" ${l.type==="Distribution"?"selected":""}>Distribution</option>
            <option value="Adjustment" ${l.type==="Adjustment"?"selected":""}>Adjustment</option>
          </select>
        </td>
        <td class="center">
          <input type="checkbox" ${l.affectsCommitment!==!1?"checked":""} data-field="affectsCommitment" data-index="${d}">
        </td>
        <td>
          <button class="delete-row-btn" data-action="deleteCashFlow" data-index="${d}" title="Delete">×</button>
        </td>
      `,s.appendChild(f)})),r&&(r.innerHTML="",[...n.monthlyNav].sort((l,d)=>new Date(d.date).getTime()-new Date(l.date).getTime()).forEach((l,d)=>{const f=document.createElement("tr");f.innerHTML=`
        <td><input type="date" value="${l.date}" data-field="date" data-index="${d}"></td>
        <td><input type="text" value="${Ne(O(l.amount)||0)}" data-field="amount" data-index="${d}"></td>
        <td>
          <button class="delete-row-btn" data-action="deleteNav" data-index="${d}" title="Delete">×</button>
        </td>
      `,r.appendChild(f)})),m.setUnsavedChanges(!1),Y("detailsModal")}function Qt(){const t=document.querySelector("#cashFlowsTable tbody");if(!t)return;const e=t.querySelectorAll("tr").length,n=new Date().toISOString().split("T")[0],a=document.createElement("tr");a.innerHTML=`
    <td><input type="date" value="${n}" data-field="date" data-index="${e}"></td>
    <td class="number"><input type="text" value="" placeholder="0" data-field="amount" data-index="${e}"></td>
    <td class="center">
      <select data-field="type" data-index="${e}">
        <option value="Contribution" selected>Contribution</option>
        <option value="Distribution">Distribution</option>
        <option value="Adjustment">Adjustment</option>
      </select>
    </td>
    <td class="center">
      <input type="checkbox" checked data-field="affectsCommitment" data-index="${e}">
    </td>
    <td>
      <button class="delete-row-btn" data-action="deleteCashFlow" data-index="${e}" title="Delete">×</button>
    </td>
  `,t.insertBefore(a,t.firstChild),m.setUnsavedChanges(!0)}function en(){const t=document.querySelector("#navTable tbody");if(!t)return;const e=t.querySelectorAll("tr").length,n=new Date().toISOString().split("T")[0],a=document.createElement("tr");a.innerHTML=`
    <td><input type="date" value="${n}" data-field="date" data-index="${e}"></td>
    <td><input type="text" value="" placeholder="0" data-field="amount" data-index="${e}"></td>
    <td>
      <button class="delete-row-btn" data-action="deleteNav" data-index="${e}" title="Delete">×</button>
    </td>
  `,t.insertBefore(a,t.firstChild),m.setUnsavedChanges(!0)}async function tn(t){if(!ke)return;const e=await ne(ke);if(!e){g("Fund not found","error");return}try{_("Saving...");const n=document.querySelectorAll("#cashFlowsTable tbody tr"),a=[];n.forEach(i=>{const c=i.querySelector('input[data-field="date"]'),u=i.querySelector('input[data-field="amount"]'),l=i.querySelector('select[data-field="type"]'),d=i.querySelector('input[data-field="affectsCommitment"]'),f=c?.value||"",E=O(u?.value||"0"),y=l?.value||"Contribution",w=d?.checked??!0;f&&!isNaN(E)&&a.push({date:f,amount:E,type:y,affectsCommitment:w})});const o=document.querySelectorAll("#navTable tbody tr"),s=[];o.forEach(i=>{const c=i.querySelector('input[data-field="date"]'),u=i.querySelector('input[data-field="amount"]'),l=c?.value||"",d=O(u?.value||"0");l&&!isNaN(d)&&s.push({date:l,amount:d})});const r={...e,cashFlows:a,monthlyNav:s,timestamp:new Date().toISOString()};await K(r),m.clearMetricsCache(),m.setUnsavedChanges(!1),g("Changes saved successfully"),R("detailsModal"),await t()}catch(n){console.error("Error saving details:",n),g("Error saving changes: "+n.message,"error")}finally{A()}}async function ye(){const t=document.getElementById("fundNamesList");if(!t)return;const e=await ge();t.innerHTML="",e.sort((n,a)=>n.name.localeCompare(a.name)).forEach(n=>{const a=document.createElement("div");a.className="fund-name-item",a.innerHTML=`
        <div>
          <strong>${M(n.name)}</strong>
          ${n.tags&&n.tags.length>0?`<div class="fund-name-tags">${n.tags.map(o=>`<span class="table-tag">${M(o)}</span>`).join("")}</div>`:""}
        </div>
        <div>
          <button class="btn-icon" data-action="editFundName" data-name="${M(n.name)}" title="Edit">✎</button>
          <button class="btn-icon danger" data-action="deleteFundName" data-name="${M(n.name)}" title="Delete">×</button>
        </div>
      `,t.appendChild(a)}),Y("manageFundNamesModal")}async function _e(){const t=document.getElementById("groupsList");if(!t)return;const e=await Q();m.setGroups(e),oe("newGroupParent");const n=Fe(e,null),a=(o,s)=>{let i=`
      <div class="group-item" style="margin-left: ${s*20}px; padding: 10px; border-bottom: 1px solid var(--color-border);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong>${M(o.name)}</strong>
            ${o.type?`<span style="font-size: 0.85em; color: var(--color-text-light);"> (${M(o.type)})</span>`:""}
          </div>
          <div>
            <button class="btn-icon" data-action="editGroup" data-id="${o.id}" title="Edit">✎</button>
            <button class="btn-icon danger" data-action="deleteGroup" data-id="${o.id}" title="Delete">×</button>
          </div>
        </div>
      </div>
    `;return o.children&&o.children.length>0&&o.children.forEach(c=>{i+=a(c,s+1)}),i};t.innerHTML=n.map(o=>a(o,0)).join(""),Y("manageGroupsModal")}async function nn(t){const e=document.getElementById("editGroupId"),n=document.getElementById("newGroupName"),a=document.getElementById("newGroupParent"),o=document.getElementById("newGroupType"),s=n?.value?.trim()||"",r=a?.value?parseInt(a.value):null,i=o?.value?.trim()||"",c=e?.value?parseInt(e.value):null;if(!s){g("Please enter a group name","error");return}try{_("Saving...");const u={id:c||0,name:s,parentGroupId:r,type:i||void 0};c&&(u.id=c),await xe(u),g(c?"Group updated successfully":"Group added successfully"),n&&(n.value=""),o&&(o.value=""),a&&(a.value=""),e&&(e.value="");const l=await Q();m.setGroups(l),await _e(),await t()}catch(u){console.error("Error saving group:",u),g("Error saving group: "+u.message,"error")}finally{A()}}async function on(t,e){const n=m.getGroupByIdSync(t);if(!n){g("Group not found","error");return}if(await re(`Are you sure you want to delete "${n.name}"? Funds in this group will become ungrouped.`,{title:"Delete Group",confirmText:"Delete",cancelText:"Cancel"}))try{_("Deleting..."),await Lt(t);const o=await $();for(const r of o)r.groupId===t&&await K({...r,groupId:null});const s=await Q();m.setGroups(s),g("Group deleted successfully"),await _e(),await e()}catch(o){console.error("Error deleting group:",o),g("Error deleting group: "+o.message,"error")}finally{A()}}let ue=[];function an(){const t=new Set;return m.fundNameData.forEach(e=>{e.tags&&e.tags.forEach(n=>t.add(n))}),[...t].sort()}function sn(t){const e=m.fundNameData.get(t);if(!e){g("Fund not found","error");return}ue=[...e.tags||[]];const n=document.getElementById("editFundNameOriginal"),a=document.getElementById("editFundNameInput"),o=document.getElementById("editFundTagsDatalist"),s=document.getElementById("editFundTermStartDate"),r=document.getElementById("editFundInvestmentTerm");n&&(n.value=t),a&&(a.value=t),s&&(s.value=e.investmentTermStartDate||""),r&&(r.value=e.investmentTermYears?.toString()||""),Pe(),o&&(o.innerHTML="",an().forEach(i=>{const c=document.createElement("option");c.value=i,o.appendChild(c)})),Y("editFundNameModal")}function Pe(){const t=document.getElementById("editFundTagsContainer");t&&(t.innerHTML="",ue.forEach((e,n)=>{const a=document.createElement("span");a.className="tag",a.innerHTML=`${M(e)} <button type="button" class="tag-remove" data-index="${n}">&times;</button>`,t.appendChild(a)}))}function rn(t){const e=t.trim();e&&!ue.includes(e)&&(ue.push(e),Pe())}function cn(t){ue.splice(t,1),Pe()}async function un(t){const e=document.getElementById("editFundNameOriginal"),n=document.getElementById("editFundNameInput"),a=document.getElementById("editFundTermStartDate"),o=document.getElementById("editFundInvestmentTerm"),s=e?.value,r=n?.value?.trim(),i=a?.value||null,c=o?.value?parseInt(o.value):null;if(!r){g("Please enter a fund name","error");return}if(r!==s&&m.fundNames.has(r)){g("A fund with this name already exists","error");return}try{if(_("Saving..."),r!==s&&s){const l=await $();for(const d of l)d.fundName===s&&await K({...d,fundName:r,timestamp:new Date().toISOString()});await mt(s),m.fundNames.delete(s),m.fundNameData.delete(s)}const u={name:r,tags:ue,investmentTermStartDate:i,investmentTermYears:c};await ce(u),m.fundNames.add(r),m.fundNameData.set(r,u),R("editFundNameModal"),g("Fund updated successfully"),await ye(),await t()}catch(u){console.error("Error saving fund name:",u),g("Error saving fund: "+u.message,"error")}finally{A()}}async function ln(t,e){const a=(await $()).filter(s=>s.fundName===t);if(a.length>0){g(`Cannot delete: ${a.length} investment(s) use this fund name`,"error");return}if(await re(`Are you sure you want to delete "${t}"? This action cannot be undone.`,{title:"Delete Fund Name",confirmText:"Delete",cancelText:"Cancel"}))try{_("Deleting..."),await mt(t),m.fundNames.delete(t),m.fundNameData.delete(t),g("Fund name deleted successfully"),await ye(),await e()}catch(s){console.error("Error deleting fund name:",s),g("Error deleting fund name: "+s.message,"error")}finally{A()}}async function dn(t){const e=document.getElementById("newFundNameInput"),n=document.getElementById("newFundTermStartDate"),a=document.getElementById("newFundInvestmentTerm"),o=e?.value?.trim(),s=n?.value||null,r=a?.value?parseInt(a.value):null;if(!o){g("Please enter a fund name","error");return}if(m.fundNames.has(o)){g("A fund with this name already exists","error");return}try{_("Adding...");const i={name:o,tags:[],investmentTermStartDate:s,investmentTermYears:r};await ce(i),m.fundNames.add(o),m.fundNameData.set(o,i),e&&(e.value=""),n&&(n.value=""),a&&(a.value="");const c=document.getElementById("newFundTermsDetails");c&&(c.open=!1),g("Fund name added successfully"),await ye(),await t()}catch(i){console.error("Error adding fund name:",i),g("Error adding fund name: "+i.message,"error")}finally{A()}}async function mn(){const t=document.getElementById("newFundNameInline"),e=t?.value?.trim();if(!e){g("Please enter a fund name","error");return}if(m.fundNames.has(e)){g("A fund with this name already exists","error");return}try{const n={name:e,tags:[],investmentTermStartDate:null,investmentTermYears:null};await ce(n),m.fundNames.add(e),m.fundNameData.set(e,n),await De();const a=document.getElementById("fundName");a&&(a.value=e);const o=document.getElementById("newFundNameContainer");o&&(o.style.display="none"),t&&(t.value=""),g("Fund name added successfully")}catch(n){console.error("Error adding fund name:",n),g("Error adding fund name: "+n.message,"error")}}function fn(){const t=document.getElementById("newFundNameContainer"),e=document.getElementById("newFundNameInline"),n=document.getElementById("fundName");t&&(t.style.display="none"),e&&(e.value=""),n&&(n.value="")}function pn(t){St=t}function Se(){return St}function se(t){if(t==null)return"";const e=typeof t=="number"?t:parseFloat(String(t));return!isFinite(e)||isNaN(e)?"":e.toFixed(2)}function Z(t){if(t==null)return"";const e=String(t),n=e.charAt(0);return e.length>0&&["=","+","-","@","	","\r"].includes(n)?"'"+e:e}async function gn(){try{const t=await $(),e=await ge(),n=await Q(),a={funds:t,fundNames:e,groups:n,exportDate:new Date().toISOString()},o=JSON.stringify(a,null,2),s=new Blob([o],{type:"application/json"}),i=`pe-funds-export-${new Date().toISOString().replace(/[:.]/g,"-")}.json`;if("showSaveFilePicker"in window)try{const d=await(await window.showSaveFilePicker({suggestedName:i,types:[{description:"JSON Files",accept:{"application/json":[".json"]}}]})).createWritable();await d.write(s),await d.close(),g("Data exported successfully");return}catch(l){if(l.name==="AbortError")return;throw l}const c=URL.createObjectURL(s),u=document.createElement("a");u.href=c,u.download=i,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c),g("Data exported successfully")}catch(t){g("Error exporting data: "+t.message,"error"),console.error("Error exporting data:",t)}}async function yn(){_("Exporting to CSV...");try{const t=await $();let e=wt(t);m.sortColumns.length>0&&(e=vt(e,m.sortColumns));const a=document.getElementById("cutoffDate")?.value,o=a?new Date(a):void 0,s=e.map(E=>({...E,metrics:pe(E,o)})),r=["Fund Name","Account Number","Vintage","Commitment","Total Contributions","Total Distributions","NAV","Investment Return","MOIC","IRR","Outstanding Commitment"],i=s.map(E=>{const y=E.metrics,w=y.investmentReturn??y.distributions+y.nav-y.calledCapital;return[Te(E.fundName),Te(E.accountNumber),Te(y.vintageYear?.toString()||""),Z(se(y.commitment)),Z(se(y.calledCapital)),Z(se(y.distributions)),Z(se(y.nav)),Z(se(w)),Z(y.moic!==null&&isFinite(y.moic)?y.moic.toFixed(2):""),Z(y.irr!==null?(y.irr*100).toFixed(2):""),Z(se(y.outstandingCommitment))].join(",")}),c=[r.join(","),...i].join(`
`),u=new Blob([c],{type:"text/csv;charset=utf-8;"}),d=`pe-funds-export-${new Date().toISOString().replace(/[:.]/g,"-").split("T")[0]}.csv`,f=document.createElement("a");if(f.download!==void 0){const E=URL.createObjectURL(u);f.setAttribute("href",E),f.setAttribute("download",d),f.style.visibility="hidden",document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(E)}g("CSV exported successfully")}catch(t){g("Error exporting CSV: "+t.message,"error"),console.error("Error exporting CSV:",t)}finally{A()}}function hn(){window.print()}let ie=null;function vn(t){const e=JSON.parse(t);return Ae(e)}function Ae(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(Ae);const e={},n=["__proto__","constructor","prototype"];for(const a of Object.keys(t)){if(n.includes(a)){console.warn(`Blocked potentially dangerous key: ${a}`);continue}e[a]=Ae(t[a])}return e}async function En(t){const e=await $(),n=new Map;e.forEach(r=>{if(r.groupId){const i=r.accountNumber.toLowerCase();n.has(i)||n.set(i,[]);const c=n.get(i);c.includes(r.groupId)||c.push(r.groupId)}});let a=0,o=0;const s=[];for(const r of t)if(r.groupId==null&&r.accountNumber){const i=r.accountNumber.toLowerCase(),c=n.get(i);c&&c.length===1?(r.groupId=c[0],r._groupAutoFilled=!0,a++):c&&c.length>1&&(o++,s.includes(r.accountNumber)||s.push(r.accountNumber))}return{enrichedCount:a,ambiguousCount:o,ambiguousAccounts:s}}function In(){ie=null;const t=document.getElementById("importPreviewContent"),e=document.getElementById("applyImportBtn");t&&(t.innerHTML='<p style="color: var(--color-text-light);">Select a JSON file to preview...</p>'),e&&(e.disabled=!0),Y("importPreviewModal")}async function wn(t){const e=t.target,n=e.files?.[0];if(!n)return;const a=document.getElementById("importPreviewContent"),o=document.getElementById("applyImportBtn");if(n.size>h.MAX_FILE_SIZE){a&&(a.innerHTML=`<p style="color: var(--color-danger);">File too large (${(n.size/1024/1024).toFixed(2)}MB). Maximum size is ${h.MAX_FILE_SIZE/1024/1024}MB.</p>`),e.value="";return}try{const s=await n.text(),r=vn(s);ie=r;const i=Array.isArray(r.funds)?r.funds.length:Array.isArray(r)?r.length:0,c=r.groups?.length||0,u=r.fundNames?.length||0;a&&(a.innerHTML=`
        <div style="margin-bottom: 15px;">
          <strong>File:</strong> ${n.name}<br>
          <strong>Size:</strong> ${(n.size/1024).toFixed(2)} KB
        </div>
        <div style="margin-bottom: 15px;">
          <strong>Contents:</strong>
          <ul style="margin: 10px 0 0 20px;">
            <li>${i} fund(s)</li>
            ${c>0?`<li>${c} group(s)</li>`:""}
            ${u>0?`<li>${u} fund name(s)</li>`:""}
          </ul>
        </div>
        ${i>0?`
          <div>
            <strong>Sample funds:</strong>
            <ul style="margin: 10px 0 0 20px; font-size: 0.9em;">
              ${(r.funds||r).slice(0,5).map(l=>`<li>${l.fundName} (${l.accountNumber})</li>`).join("")}
              ${i>5?`<li>... and ${i-5} more</li>`:""}
            </ul>
          </div>
        `:""}
      `),o&&(o.disabled=!1)}catch(s){a&&(a.innerHTML=`<p style="color: var(--color-danger);">Error reading file: ${s.message}</p>`),ie=null,e.value=""}}async function bn(t){if(!ie){g("No import data available","error");return}R("importPreviewModal"),_("Importing data...");try{const e=ie;let n=0;const a={};if(e.groups&&Array.isArray(e.groups)){if(e.groups.length>h.MAX_IMPORT_GROUPS)throw new Error(`Too many groups (${e.groups.length}). Maximum allowed is ${h.MAX_IMPORT_GROUPS}.`);const d=new Set(e.groups.map(C=>C.id));for(const C of e.groups)C.parentGroupId!=null&&(d.has(C.parentGroupId)||(C.parentGroupId=null),C.id===C.parentGroupId&&(C.parentGroupId=null));const f=[],E=new Set;let y=[...e.groups];for(;y.length>0;){const C=y.length;for(let S=y.length-1;S>=0;S--){const U=y[S];(U.parentGroupId==null||E.has(U.parentGroupId))&&(f.push(U),E.add(U.id),y.splice(S,1))}if(y.length===C){y.forEach(S=>{S.parentGroupId=null,f.push(S)});break}}const w=await Q(),F={};w.forEach(C=>{F[C.name.toLowerCase()]=C});for(const C of f){const S=C.id,{id:U,...q}=C;q.parentGroupId!=null&&a[q.parentGroupId]&&(q.parentGroupId=a[q.parentGroupId]);const V=F[q.name.toLowerCase()];if(V)S!=null&&(a[S]=V.id);else{const W=await xe(q);S!=null&&W&&(a[S]=W),F[q.name.toLowerCase()]={...q,id:W}}}m.setGroups(await Q())}if(e.fundNames&&Array.isArray(e.fundNames)){if(e.fundNames.length>h.MAX_IMPORT_FUNDNAMES)throw new Error(`Too many fund names (${e.fundNames.length}). Maximum allowed is ${h.MAX_IMPORT_FUNDNAMES}.`);for(const d of e.fundNames){const f=typeof d=="string"?{name:d,tags:[],investmentTermStartDate:null,investmentTermYears:null}:{name:d.name,tags:d.tags||[],investmentTermStartDate:d.investmentTermStartDate||d.finalCloseDate||null,investmentTermYears:d.investmentTermYears||null};await ce(f),m.fundNames.add(f.name),m.fundNameData.set(f.name,f)}}const o=e.funds||e;if(!Array.isArray(o))throw new Error("Invalid format: expected array of funds");if(o.length>h.MAX_IMPORT_FUNDS)throw new Error(`Too many funds (${o.length}). Maximum allowed is ${h.MAX_IMPORT_FUNDS}.`);const s=new Set;o.forEach(d=>{d.fundName&&!m.fundNames.has(d.fundName)&&s.add(d.fundName)});for(const d of s){const f={name:d,tags:[],investmentTermStartDate:null,investmentTermYears:null};await ce(f),m.fundNames.add(d),m.fundNameData.set(d,f)}const r=await En(o),i=await $(),c=new Set;i.forEach(d=>{const f=`${d.fundName}|${d.accountNumber}`.toLowerCase();c.add(f)});const u=[],l=[];for(let d=0;d<o.length;d++){const f=o[d],E=`${f.fundName}|${f.accountNumber}`.toLowerCase();if(c.has(E)){u.push({index:d,name:f.fundName,account:f.accountNumber});continue}try{c.add(E);const y=(f.cashFlows||[]).map(S=>({date:S.date,amount:O(S.amount),type:S.type||(S.amount<0?"Contribution":"Distribution"),affectsCommitment:S.affectsCommitment!==void 0?S.affectsCommitment:!0})),w=(f.monthlyNav||[]).map(S=>({date:S.date,amount:O(S.amount)}));let F=null;f.groupId!=null&&(f._groupAutoFilled?F=f.groupId:a[f.groupId]&&(F=a[f.groupId]));const C={fundName:f.fundName,accountNumber:(f.accountNumber||"").replace(/\s/g,""),groupId:F,commitment:O(f.commitment),cashFlows:y,monthlyNav:w,timestamp:f.timestamp||new Date().toISOString()};await K(C),n++}catch(y){console.error(`Error importing fund at index ${d}:`,y),l.push({index:d,name:f.fundName||f.accountNumber||"Unknown",error:y.message})}}if(l.length>0||u.length>0){const d=[];n>0&&d.push(`${n} imported`),u.length>0&&d.push(`${u.length} duplicates skipped`),l.length>0&&d.push(`${l.length} failed`),r.enrichedCount>0&&d.push(`${r.enrichedCount} groups auto-filled`);const f=l.length>0?"error":"success";g(`Import complete: ${d.join(", ")}`,f)}else{let d=`Successfully imported ${n} fund(s)`;r.enrichedCount>0&&(d+=` (${r.enrichedCount} groups auto-filled)`),g(d)}ie=null,await t()}catch(e){g("Error importing data: "+e.message,"error"),console.error("Error importing data:",e)}finally{A()}}async function Sn(t){_("Loading sample data...");try{const e=[{name:"Buyout Funds",parentGroupId:null,type:"Strategy"},{name:"Venture Capital",parentGroupId:null,type:"Strategy"},{name:"Real Estate",parentGroupId:null,type:"Strategy"}],n={};for(const s of e){const r=await xe(s);n[s.name]=r}m.setGroups(await Q());const a=[{name:"Apex Capital Partners",tags:["Buyout","North America"],investmentTermStartDate:"2020-06-15",investmentTermYears:10},{name:"Summit Growth Fund",tags:["Growth","Technology"],investmentTermStartDate:"2021-03-01",investmentTermYears:10},{name:"Horizon Ventures",tags:["Venture","Early Stage"],investmentTermStartDate:"2022-01-10",investmentTermYears:12},{name:"Metro Real Estate Partners",tags:["Real Estate","Commercial"],investmentTermStartDate:"2019-09-01",investmentTermYears:8},{name:"Blue Ocean Capital",tags:["Buyout","Europe"],investmentTermStartDate:"2021-07-20",investmentTermYears:10}];for(const s of a)await ce(s),m.fundNames.add(s.name),m.fundNameData.set(s.name,s);const o=[{fundName:"Apex Capital Partners",accountNumber:"APEX-001",groupId:n["Buyout Funds"]??null,commitment:5e6,cashFlows:[{date:"2020-07-01",amount:-125e4,type:"Contribution",affectsCommitment:!0},{date:"2020-12-15",amount:-1e6,type:"Contribution",affectsCommitment:!0},{date:"2021-06-30",amount:-75e4,type:"Contribution",affectsCommitment:!0},{date:"2022-03-15",amount:-5e5,type:"Contribution",affectsCommitment:!0},{date:"2023-01-20",amount:8e5,type:"Distribution",affectsCommitment:!0},{date:"2023-09-10",amount:12e5,type:"Distribution",affectsCommitment:!0}],monthlyNav:[{date:"2021-12-31",amount:32e5},{date:"2022-12-31",amount:38e5},{date:"2023-12-31",amount:45e5}],timestamp:new Date().toISOString()},{fundName:"Summit Growth Fund",accountNumber:"SUMMIT-001",groupId:n["Venture Capital"]??null,commitment:25e5,cashFlows:[{date:"2021-04-01",amount:-625e3,type:"Contribution",affectsCommitment:!0},{date:"2021-10-15",amount:-5e5,type:"Contribution",affectsCommitment:!0},{date:"2022-06-30",amount:-375e3,type:"Contribution",affectsCommitment:!0},{date:"2023-06-15",amount:4e5,type:"Distribution",affectsCommitment:!0}],monthlyNav:[{date:"2022-12-31",amount:18e5},{date:"2023-12-31",amount:22e5}],timestamp:new Date().toISOString()},{fundName:"Horizon Ventures",accountNumber:"HV-001",groupId:n["Venture Capital"]??null,commitment:1e6,cashFlows:[{date:"2022-02-01",amount:-25e4,type:"Contribution",affectsCommitment:!0},{date:"2022-08-15",amount:-2e5,type:"Contribution",affectsCommitment:!0},{date:"2023-04-01",amount:-15e4,type:"Contribution",affectsCommitment:!0}],monthlyNav:[{date:"2022-12-31",amount:52e4},{date:"2023-12-31",amount:75e4}],timestamp:new Date().toISOString()},{fundName:"Metro Real Estate Partners",accountNumber:"METRO-001",groupId:n["Real Estate"]??null,commitment:3e6,cashFlows:[{date:"2019-10-01",amount:-75e4,type:"Contribution",affectsCommitment:!0},{date:"2020-04-15",amount:-6e5,type:"Contribution",affectsCommitment:!0},{date:"2020-12-01",amount:-45e4,type:"Contribution",affectsCommitment:!0},{date:"2021-06-30",amount:-3e5,type:"Contribution",affectsCommitment:!0},{date:"2022-03-15",amount:5e5,type:"Distribution",affectsCommitment:!0},{date:"2023-03-15",amount:6e5,type:"Distribution",affectsCommitment:!0}],monthlyNav:[{date:"2021-12-31",amount:24e5},{date:"2022-12-31",amount:28e5},{date:"2023-12-31",amount:31e5}],timestamp:new Date().toISOString()},{fundName:"Blue Ocean Capital",accountNumber:"BOC-001",groupId:n["Buyout Funds"]??null,commitment:4e6,cashFlows:[{date:"2021-08-01",amount:-1e6,type:"Contribution",affectsCommitment:!0},{date:"2022-02-15",amount:-8e5,type:"Contribution",affectsCommitment:!0},{date:"2022-09-01",amount:-6e5,type:"Contribution",affectsCommitment:!0},{date:"2023-05-15",amount:7e5,type:"Distribution",affectsCommitment:!0}],monthlyNav:[{date:"2022-12-31",amount:26e5},{date:"2023-12-31",amount:32e5}],timestamp:new Date().toISOString()}];for(const s of o)await K(s);m.clearMetricsCache(),g(`Successfully loaded ${o.length} sample investments`),await t()}catch(e){g("Error loading sample data: "+e.message,"error"),console.error("Error loading sample data:",e)}finally{A()}}async function Nt(t){const e=document.getElementById(t);if(!e)return;const a=(await ge()).map(o=>o.name).sort();e.innerHTML='<option value="">Select a fund</option>',a.forEach(o=>{const s=document.createElement("option");s.value=o,s.textContent=o,e.appendChild(s)})}async function Nn(t){const e=document.getElementById(t);if(!e)return;const n=await $(),a=[...new Set(n.map(o=>o.accountNumber))].sort();e.innerHTML='<option value="">Select an account</option>',a.forEach(o=>{const s=document.createElement("option");s.value=o,s.textContent=o,e.appendChild(s)})}async function Cn(){await Nt("bulkCashFlowFundName");const t=document.getElementById("bulkCashFlowDate"),e=document.getElementById("bulkCashFlowType"),n=document.getElementById("bulkCashFlowPercentage"),a=document.getElementById("bulkCashFlowAffectsCommitment"),o=document.getElementById("bulkCashFlowPreview"),s=document.getElementById("applyBulkCashFlowBtn");t&&(t.value=new Date().toISOString().split("T")[0]||""),e&&(e.value="Contribution"),n&&(n.value=""),a&&(a.checked=!0),o&&(o.style.display="none"),s&&(s.disabled=!0),Y("bulkCashFlowModal")}async function Bn(){const t=document.getElementById("bulkCashFlowFundName"),e=document.getElementById("bulkCashFlowPercentage"),n=document.getElementById("bulkCashFlowType"),a=document.getElementById("bulkCashFlowPreview"),o=document.getElementById("bulkCashFlowPreviewContent"),s=document.getElementById("applyBulkCashFlowBtn"),r=t?.value,i=parseFloat(e?.value||"0"),c=n?.value||"Contribution";if(!r){g("Please select a fund","error");return}if(isNaN(i)||i<=0||i>100){g("Please enter a valid percentage (0.01 - 100)","error");return}const l=(await $()).filter(y=>y.fundName===r);if(l.length===0){g("No investments found for this fund","error");return}let d='<table style="width: 100%; font-size: 0.9em;"><thead><tr><th>Account</th><th style="text-align: right;">Commitment</th><th style="text-align: right;">Amount</th></tr></thead><tbody>',f=0;l.forEach(y=>{const w=y.commitment*(i/100);f+=w;const F=c==="Contribution"?-w:w;d+=`<tr><td>${M(y.accountNumber)}</td><td style="text-align: right;">${B(y.commitment)}</td><td style="text-align: right;">${B(F)}</td></tr>`});const E=c==="Contribution"?-f:f;d+=`</tbody><tfoot><tr style="font-weight: bold;"><td>Total (${l.length} investors)</td><td></td><td style="text-align: right;">${B(E)}</td></tr></tfoot></table>`,o&&(o.innerHTML=d),a&&(a.style.display="block"),s&&(s.disabled=!1)}async function Fn(t){const e=document.getElementById("bulkCashFlowFundName"),n=document.getElementById("bulkCashFlowDate"),a=document.getElementById("bulkCashFlowType"),o=document.getElementById("bulkCashFlowPercentage"),s=document.getElementById("bulkCashFlowAffectsCommitment"),r=e?.value,i=n?.value,c=a?.value||"Contribution",u=parseFloat(o?.value||"0"),l=s?.checked??!0;if(!r||!i||isNaN(u)){g("Missing required fields","error");return}R("bulkCashFlowModal"),_("Applying bulk cash flow...");try{const f=(await $()).filter(y=>y.fundName===r);let E=0;for(const y of f){const w=y.commitment*(u/100),F=c==="Contribution"?-w:w,C={...y,cashFlows:[...y.cashFlows,{date:i,amount:F,type:c,affectsCommitment:l}],timestamp:new Date().toISOString()};await K(C),E++}m.clearMetricsCache(),g(`Successfully added cash flow to ${E} investment(s)`),await t()}catch(d){g("Error applying bulk cash flow: "+d.message,"error")}finally{A()}}async function Dn(){await Nt("bulkRemoveFundName");const t=document.getElementById("bulkRemoveFundPreview"),e=document.getElementById("applyBulkRemoveFundBtn");t&&(t.style.display="none"),e&&(e.disabled=!0),Y("bulkRemoveFundModal")}async function Tn(){const t=document.getElementById("bulkRemoveFundName"),e=document.getElementById("bulkRemoveFundPreview"),n=document.getElementById("bulkRemoveFundPreviewContent"),a=document.getElementById("applyBulkRemoveFundBtn"),o=t?.value;if(!o){g("Please select a fund","error");return}const r=(await $()).filter(c=>c.fundName===o);if(r.length===0){g("No investments found for this fund","error");return}let i='<ul style="margin: 0; padding-left: 20px;">';r.forEach(c=>{i+=`<li>${M(c.accountNumber)} - ${B(c.commitment)}</li>`}),i+="</ul>",i+=`<p style="margin-top: 10px; font-weight: bold; color: var(--color-danger);">Total: ${r.length} investment(s) will be permanently deleted.</p>`,n&&(n.innerHTML=i),e&&(e.style.display="block"),a&&(a.disabled=!1)}async function Mn(t){const n=document.getElementById("bulkRemoveFundName")?.value;if(!n){g("Please select a fund","error");return}R("bulkRemoveFundModal"),_("Removing investments...");try{const o=(await $()).filter(r=>r.fundName===n);let s=0;for(const r of o)r.id&&(await dt(r.id),s++);m.clearMetricsCache(),g(`Successfully removed ${s} investment(s)`),await t()}catch(a){g("Error removing investments: "+a.message,"error")}finally{A()}}async function kn(){await Nn("bulkAssignGroupAccount"),oe("bulkAssignGroupTarget");const t=document.getElementById("bulkAssignGroupPreview"),e=document.getElementById("applyBulkAssignGroupBtn");t&&(t.style.display="none"),e&&(e.disabled=!0),Y("bulkAssignGroupModal")}async function An(){const t=document.getElementById("bulkAssignGroupAccount"),e=document.getElementById("bulkAssignGroupTarget"),n=document.getElementById("bulkAssignGroupPreview"),a=document.getElementById("bulkAssignGroupPreviewContent"),o=document.getElementById("applyBulkAssignGroupBtn"),s=t?.value,r=e?.value?parseInt(e.value):null;if(!s){g("Please select an account","error");return}const c=(await $()).filter(d=>d.accountNumber===s);if(c.length===0){g("No investments found for this account","error");return}const u=r?m.getGroupByIdSync(r)?.name||"Unknown":"No Group";let l='<ul style="margin: 0; padding-left: 20px;">';c.forEach(d=>{l+=`<li>${M(d.fundName)}</li>`}),l+="</ul>",l+=`<p style="margin-top: 10px;">These ${c.length} investment(s) will be assigned to: <strong>${M(u)}</strong></p>`,a&&(a.innerHTML=l),n&&(n.style.display="block"),o&&(o.disabled=!1)}async function Rn(t){const e=document.getElementById("bulkAssignGroupAccount"),n=document.getElementById("bulkAssignGroupTarget"),a=e?.value,o=n?.value?parseInt(n.value):null;if(!a){g("Please select an account","error");return}R("bulkAssignGroupModal"),_("Assigning group...");try{const r=(await $()).filter(c=>c.accountNumber===a);let i=0;for(const c of r){const u={...c,groupId:o,timestamp:new Date().toISOString()};await K(u),i++}m.clearMetricsCache(),g(`Successfully updated ${i} investment(s)`),await t()}catch(s){g("Error assigning group: "+s.message,"error")}finally{A()}}function xn(t){const e=document.getElementById("closeBulkCashFlowModalBtn"),n=document.getElementById("cancelBulkCashFlowBtn"),a=document.getElementById("previewBulkCashFlowBtn"),o=document.getElementById("applyBulkCashFlowBtn");[e,n].forEach(E=>{E&&E.addEventListener("click",()=>R("bulkCashFlowModal"))}),a&&a.addEventListener("click",Bn),o&&o.addEventListener("click",()=>Fn(t));const s=document.getElementById("closeBulkRemoveFundModalBtn"),r=document.getElementById("cancelBulkRemoveFundBtn"),i=document.getElementById("previewBulkRemoveFundBtn"),c=document.getElementById("applyBulkRemoveFundBtn");[s,r].forEach(E=>{E&&E.addEventListener("click",()=>R("bulkRemoveFundModal"))}),i&&i.addEventListener("click",Tn),c&&c.addEventListener("click",()=>Mn(t));const u=document.getElementById("closeBulkAssignGroupModalBtn"),l=document.getElementById("cancelBulkAssignGroupBtn"),d=document.getElementById("previewBulkAssignGroupBtn"),f=document.getElementById("applyBulkAssignGroupBtn");[u,l].forEach(E=>{E&&E.addEventListener("click",()=>R("bulkAssignGroupModal"))}),d&&d.addEventListener("click",An),f&&f.addEventListener("click",()=>Rn(t))}function Ln(t,e){let n;return function(...o){const s=()=>{clearTimeout(n),t(...o)};clearTimeout(n),n=setTimeout(s,e)}}function ut(t){const e=document.getElementById("filterLoading");e&&e.classList.toggle("show",t)}function Gn(t){const e=document.getElementById("srAnnounce");e&&(e.textContent=t,setTimeout(()=>{e.textContent=""},1e3))}async function G(){try{const t=await $();m.setFunds(t);let e=wt(t);m.sortColumns.length>0&&(e=vt(e,m.sortColumns)),Xt(t),Yt();const a=document.getElementById("cutoffDate")?.value,o=a?new Date(a):void 0,s=e.map(l=>({...l,metrics:pe(l,o)}));qt(s,o);const r=document.getElementById("fundsTableBody");if(!r)return;if(r.innerHTML="",s.length===0){const l=T("fundFilter").length>0||T("accountFilter").length>0||T("groupFilter").length>0||T("tagFilter").length>0||T("vintageFilter").length>0,d=t.length>0;let f;l&&d?f=`
          <tr>
            <td colspan="12" class="empty-state">
              <div style="padding: 40px;">
                <h3 style="margin-bottom: 10px;">No matching investments</h3>
                <p style="margin-bottom: 15px;">No investments match your current filters.</p>
                <button type="button" class="btn-secondary" id="clearFiltersBtn">Clear All Filters</button>
              </div>
            </td>
          </tr>
        `:f=`
          <tr>
            <td colspan="12" class="empty-state">
              <div style="padding: 40px;">
                <h3 style="margin-bottom: 10px;">No investments yet</h3>
                <p style="margin-bottom: 15px;">Add your first investment to start tracking your portfolio.</p>
                <button type="button" class="btn-primary" id="addFirstInvestmentBtn">Add Investment</button>
              </div>
            </td>
          </tr>
        `,r.innerHTML=f;const E=document.getElementById("clearFiltersBtn");E&&E.addEventListener("click",()=>{bt(),Ct()});const y=document.getElementById("addFirstInvestmentBtn");y&&y.addEventListener("click",Be);return}const i=document.getElementById("sidebarShowTagsCheckbox")?.checked??!0;s.forEach((l,d)=>{const f=document.createElement("tr");f.setAttribute("tabindex","0"),f.setAttribute("data-fund-id",l.id?.toString()||""),f.setAttribute("role","row"),f.setAttribute("aria-rowindex",(d+2).toString()),f.innerHTML=Pt(l,d,i),r.appendChild(f)});const c=Et(s,o),u=document.createElement("tr");u.innerHTML=Ut(c),r.appendChild(u)}catch(t){console.error("Error rendering table:",t),g("Error loading data: "+t.message,"error")}}async function Ct(){m.abortController&&m.abortController.abort(),m.setAbortController(new AbortController);const t=m.abortController.signal;ut(!0);try{if(t.aborted||(On(),t.aborted))return;await G();const e=document.getElementById("summaryInvestmentCount")?.textContent||"0";Gn(`Filter applied. Showing ${e} investments.`)}catch(e){if(e.name==="AbortError")return;console.error("Error applying filters:",e),g("Error applying filters: "+e.message,"error")}finally{ut(!1),m.abortController&&!m.abortController.signal.aborted&&m.setAbortController(null)}}const Bt=Ln(Ct,h.DEBOUNCE_FILTER);function On(){const t=T("groupFilter"),e=document.getElementById("headerTitle"),n=document.getElementById("headerSubtitle");if(!(!e||!n))if(t.length===1&&t[0]){const a=parseInt(t[0]),o=m.getGroupByIdSync(a);if(o)if(e.textContent=o.name,o.parentGroupId){const s=m.getGroupByIdSync(o.parentGroupId);n.textContent=s?.name||o.type||"Account Group"}else n.textContent=""}else if(t.length>1){const a=t.map(s=>m.getGroupByIdSync(parseInt(s))),o=new Set(a.map(s=>s?.parentGroupId).filter(s=>s!=null));if(o.size===1){const s=Array.from(o)[0],r=m.getGroupByIdSync(s);r?(e.textContent=r.name,n.textContent="Multiple Groups Selected"):(e.textContent="PE Fund Manager",n.textContent="Multiple Groups Selected")}else e.textContent="PE Fund Manager",n.textContent="Multiple Groups Selected"}else e.textContent="PE Fund Manager",n.textContent="Private Equity Fund Analytics & Management Tool"}function $n(t){const n=t.target.closest("th[data-sort]");if(!n)return;const a=n.dataset.sort;if(!a)return;if(t.shiftKey){const s=m.sortColumns.findIndex(r=>r.column===a);s!==-1?m.sortColumns[s].direction==="asc"?m.sortColumns[s]={column:a,direction:"desc"}:m.sortColumns.splice(s,1):m.sortColumns.push({column:a,direction:"asc"})}else{const s=m.sortColumns.find(r=>r.column===a);s?s.direction==="asc"?m.setSortColumns([{column:a,direction:"desc"}]):m.setSortColumns([]):m.setSortColumns([{column:a,direction:"asc"}])}Vt(m.sortColumns),G()}function _n(t){const n=t.target.closest(".fund-actions-btn");if(!n)return;t.stopPropagation();const a=parseInt(n.dataset.fundId||"0");if(!a)return;pn(a);const o=document.getElementById("actionDropdown");if(!o)return;const s=n.getBoundingClientRect();o.style.top=`${s.bottom+window.scrollY}px`,o.style.left=`${s.left+window.scrollX}px`,o.classList.add("show")}function Pn(t){const e=t.target;if(e.closest(".fund-actions-btn"))return;const n=e.closest("tr[data-fund-id]");if(!n)return;const a=parseInt(n.dataset.fundId||"0");a&&$e(a)}function Un(t){const n=t.target.closest("tr[data-fund-id]");if(!n)return;const a=parseInt(n.dataset.fundId||"0");a&&(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),$e(a))}function qn(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebarOverlay");t&&t.classList.add("open"),e&&e.classList.add("show")}function P(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebarOverlay");t&&t.classList.remove("open"),e&&e.classList.remove("show")}function Vn(){const t=document.getElementById("sidebarDarkModeCheckbox");if(!t)return;const e=localStorage.getItem("theme"),n=window.matchMedia("(prefers-color-scheme: dark)").matches,a=e?e==="dark":n;document.documentElement.setAttribute("data-theme",a?"dark":"light"),t.checked=a,t.addEventListener("change",()=>{const o=t.checked?"dark":"light";document.documentElement.setAttribute("data-theme",o),localStorage.setItem("theme",o)})}function jn(){document.querySelectorAll(".multi-select").forEach(e=>{const n=e.querySelector(".multi-select-trigger"),a=e.querySelector(".multi-select-dropdown");!n||!a||(n.addEventListener("click",o=>{o.stopPropagation();const s=e.classList.contains("open");document.querySelectorAll(".multi-select.open").forEach(r=>{r.classList.remove("open"),r.querySelector(".multi-select-trigger")?.setAttribute("aria-expanded","false"),be(r)}),s||(e.classList.add("open"),n.setAttribute("aria-expanded","true"),setTimeout(()=>{const r=a.querySelector(".multi-select-search input");r&&r.focus()},0))}),n.addEventListener("keydown",o=>{const s=o;s.key==="Enter"||s.key===" "?(s.preventDefault(),n.click()):s.key==="Escape"&&(e.classList.remove("open"),n.setAttribute("aria-expanded","false"),be(e))}),a.addEventListener("input",o=>{const s=o.target;s.matches(".multi-select-search input")&&It(e,s.value)}),a.addEventListener("keydown",o=>{o.key==="Escape"&&(e.classList.remove("open"),n.setAttribute("aria-expanded","false"),be(e),n.focus())}),a.addEventListener("click",o=>{const s=o.target;if(s.closest(".multi-select-search")){o.stopPropagation();return}const r=s.closest(".multi-select-option");if(r){o.stopPropagation(),r.classList.toggle("selected");const i=r.querySelector('input[type="checkbox"]');if(i&&(i.checked=r.classList.contains("selected")),r.setAttribute("aria-selected",r.classList.contains("selected").toString()),e.id==="groupFilter"){const c=parseInt(r.getAttribute("data-value")||"0"),u=r.classList.contains("selected");zt(e,c,u)}Oe(e.id),Bt()}}))}),document.addEventListener("click",e=>{e.target.closest(".multi-select")||document.querySelectorAll(".multi-select.open").forEach(n=>{n.classList.remove("open"),n.querySelector(".multi-select-trigger")?.setAttribute("aria-expanded","false"),be(n)})})}function Hn(){const t=document.querySelector("#fundsTable thead");t&&t.addEventListener("click",$n);const e=document.getElementById("fundsTableBody");e&&(e.addEventListener("click",p=>{_n(p),Pn(p)}),e.addEventListener("keydown",Un)),document.addEventListener("click",p=>{const I=document.getElementById("actionDropdown"),N=p.target;I&&!N.closest("#actionDropdown")&&!N.closest(".fund-actions-btn")&&I.classList.remove("show")});const n=document.getElementById("actionEdit"),a=document.getElementById("actionDuplicate"),o=document.getElementById("actionViewDetails"),s=document.getElementById("actionDelete");n&&n.addEventListener("click",p=>{p.preventDefault();const I=Se();I&&Kt(I),document.getElementById("actionDropdown")?.classList.remove("show")}),a&&a.addEventListener("click",p=>{p.preventDefault();const I=Se();I&&Wt(I),document.getElementById("actionDropdown")?.classList.remove("show")}),o&&o.addEventListener("click",p=>{p.preventDefault();const I=Se();I&&$e(I),document.getElementById("actionDropdown")?.classList.remove("show")}),s&&s.addEventListener("click",async p=>{p.preventDefault();const I=Se();I&&await Zt(I,G),document.getElementById("actionDropdown")?.classList.remove("show")});const r=document.getElementById("fundForm");r&&r.addEventListener("submit",async p=>{p.preventDefault(),await Jt(G)});const i=document.getElementById("closeFundModalBtn"),c=document.getElementById("cancelFundModalBtn");[i,c].forEach(p=>{p&&p.addEventListener("click",()=>R("fundModal"))});const u=document.getElementById("fundName");u&&u.addEventListener("change",p=>{const I=p.target.value,N=document.getElementById("newFundNameContainer");I==="__new__"&&N?(N.style.display="block",document.getElementById("newFundNameInline")?.focus()):N&&(N.style.display="none")});const l=document.getElementById("addCashFlowRowBtn"),d=document.getElementById("addNavRowBtn"),f=document.getElementById("saveDetailsChangesBtn"),E=document.getElementById("cancelDetailsModalBtn"),y=document.getElementById("closeDetailsModalBtn");l&&l.addEventListener("click",Qt),d&&d.addEventListener("click",en),f&&f.addEventListener("click",()=>tn(G)),[E,y].forEach(p=>{p&&p.addEventListener("click",async()=>{m.hasUnsavedChanges&&!await re("You have unsaved changes. Discard them?",{title:"Unsaved Changes",confirmText:"Discard",cancelText:"Keep Editing"})||(m.setUnsavedChanges(!1),R("detailsModal"))})});const w=document.getElementById("cashFlowsTable"),F=document.getElementById("navTable");[w,F].forEach(p=>{p&&(p.addEventListener("click",I=>{const X=I.target.closest(".delete-row-btn");if(X){const x=X.closest("tr");x&&(x.remove(),m.setUnsavedChanges(!0))}}),p.addEventListener("input",()=>{m.setUnsavedChanges(!0)}))});const C=document.getElementById("sidebarManageFunds");C&&C.addEventListener("click",p=>{p.preventDefault(),P(),ye()});const S=document.getElementById("closeManageFundsModalBtn"),U=document.getElementById("closeManageFundsModal2Btn");[S,U].forEach(p=>{p&&p.addEventListener("click",()=>R("manageFundNamesModal"))});const q=document.getElementById("addNewFundNameModalBtn");q&&q.addEventListener("click",()=>dn(G));const V=document.getElementById("fundNamesList");V&&V.addEventListener("click",async p=>{const N=p.target.closest("button");if(!N)return;const X=N.dataset.action,x=N.dataset.name;X==="editFundName"&&x?sn(x):X==="deleteFundName"&&x&&await ln(x,G)});const W=document.getElementById("closeEditFundNameModalBtn"),he=document.getElementById("cancelEditFundNameBtn");[W,he].forEach(p=>{p&&p.addEventListener("click",()=>R("editFundNameModal"))});const ve=document.getElementById("saveEditedFundNameBtn");ve&&ve.addEventListener("click",()=>un(G));const ae=document.getElementById("editFundTagsInput");ae&&ae.addEventListener("keydown",p=>{if(p.key==="Enter"){p.preventDefault();const I=ae.value.trim();I&&(rn(I),ae.value="")}});const le=document.getElementById("editFundTagsContainer");le&&le.addEventListener("click",p=>{const I=p.target;if(I.classList.contains("tag-remove")){const N=parseInt(I.dataset.index||"0");cn(N)}});const de=document.getElementById("addNewFundNameBtn");de&&de.addEventListener("click",mn);const Ee=document.getElementById("cancelNewFundNameBtn");Ee&&Ee.addEventListener("click",fn);const Ie=document.getElementById("sidebarManageGroups");Ie&&Ie.addEventListener("click",p=>{p.preventDefault(),P(),_e()});const v=document.getElementById("closeManageGroupsModalBtn"),b=document.getElementById("closeManageGroupsModal2Btn");[v,b].forEach(p=>{p&&p.addEventListener("click",()=>R("manageGroupsModal"))});const D=document.getElementById("saveGroupBtn");D&&D.addEventListener("click",()=>nn(G));const j=document.getElementById("groupsList");j&&j.addEventListener("click",async p=>{const N=p.target.closest("button");if(!N)return;const X=N.dataset.action,x=parseInt(N.dataset.id||"0");if(X==="editGroup"&&x){const te=m.getGroupByIdSync(x);if(te){const tt=document.getElementById("editGroupId"),nt=document.getElementById("newGroupName"),ot=document.getElementById("newGroupParent"),at=document.getElementById("newGroupType"),st=document.getElementById("saveGroupBtn"),rt=document.getElementById("cancelEditBtn"),it=document.getElementById("groupFormTitle");tt&&(tt.value=x.toString()),nt&&(nt.value=te.name),at&&(at.value=te.type||""),st&&(st.textContent="Update Group"),rt&&(rt.style.display="inline-block"),it&&(it.textContent="Edit Group"),oe("newGroupParent",x),ot&&(ot.value=te.parentGroupId?.toString()||"")}}else X==="deleteGroup"&&x&&await on(x,G)});const H=document.getElementById("cancelEditBtn");H&&H.addEventListener("click",()=>{const p=document.getElementById("editGroupId"),I=document.getElementById("newGroupName"),N=document.getElementById("newGroupParent"),X=document.getElementById("newGroupType"),x=document.getElementById("saveGroupBtn"),te=document.getElementById("groupFormTitle");p&&(p.value=""),I&&(I.value=""),X&&(X.value=""),N&&(N.value=""),x&&(x.textContent="Add Group"),te&&(te.textContent="Add New Group"),H.style.display="none",oe("newGroupParent")});const J=document.getElementById("toggleSidebarBtn"),z=document.getElementById("closeSidebarBtn"),Ue=document.getElementById("sidebarOverlay");J&&J.addEventListener("click",qn),z&&z.addEventListener("click",P),Ue&&Ue.addEventListener("click",P);const qe=document.getElementById("sidebarNewInvestment");qe&&qe.addEventListener("click",p=>{p.preventDefault(),P(),Be()});const we=document.getElementById("sidebarShowTagsCheckbox");if(we){we.addEventListener("change",()=>{const I=we.checked;localStorage.setItem("showTags",I.toString()),G()});const p=localStorage.getItem("showTags");p!==null&&(we.checked=p==="true")}const Ve=document.getElementById("sidebarClearDatabase");Ve&&Ve.addEventListener("click",async p=>{if(p.preventDefault(),P(),await re("Are you sure you want to clear ALL data? This action cannot be undone!",{title:"Clear Database",confirmText:"Clear All Data",cancelText:"Cancel"}))try{_("Clearing database..."),await Gt(),m.clearMetricsCache(),m.setFunds([]),m.setGroups([]),g("Database cleared successfully"),await G()}catch(N){console.error("Error clearing database:",N),g("Error clearing database: "+N.message,"error")}finally{A()}});const je=document.getElementById("sidebarExportCSV");je&&je.addEventListener("click",async p=>{p.preventDefault(),P(),await yn()});const He=document.getElementById("sidebarExportJSON");He&&He.addEventListener("click",async p=>{p.preventDefault(),P(),await gn()});const Ye=document.getElementById("sidebarExportPDF");Ye&&Ye.addEventListener("click",p=>{p.preventDefault(),P(),hn()});const ze=document.getElementById("sidebarImportJSON");ze&&ze.addEventListener("click",p=>{p.preventDefault(),P(),In()});const Xe=document.getElementById("sidebarLoadSampleData");Xe&&Xe.addEventListener("click",async p=>{p.preventDefault(),P(),await re("This will add sample data to your database. Existing data will not be deleted. Continue?",{title:"Load Sample Data",confirmText:"Load Data",cancelText:"Cancel"})&&await Sn(G)});const Ke=document.getElementById("sidebarBulkCashFlow");Ke&&Ke.addEventListener("click",p=>{p.preventDefault(),P(),Cn()});const We=document.getElementById("sidebarBulkAssignGroup");We&&We.addEventListener("click",p=>{p.preventDefault(),P(),kn()});const Je=document.getElementById("sidebarBulkRemoveFund");Je&&Je.addEventListener("click",p=>{p.preventDefault(),P(),Dn()}),xn(G);const Ze=document.getElementById("importPreviewFileInput");Ze&&Ze.addEventListener("change",wn);const Qe=document.getElementById("applyImportBtn");Qe&&Qe.addEventListener("click",()=>bn(G));const Ft=document.getElementById("closeImportPreviewModalBtn"),Dt=document.getElementById("cancelImportPreviewBtn");[Ft,Dt].forEach(p=>{p&&p.addEventListener("click",()=>R("importPreviewModal"))});const et=document.getElementById("cutoffDate");et&&et.addEventListener("change",Bt),document.addEventListener("keydown",p=>{const I=p.target;I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.tagName==="SELECT"||(p.ctrlKey&&p.key==="n"?(p.preventDefault(),Be()):p.key==="?"&&!p.ctrlKey&&!p.metaKey?Y("shortcutsModal"):p.key==="Escape"&&(P(),document.querySelectorAll(".modal.show").forEach(N=>{R(N.id)})))});const Tt=document.getElementById("closeShortcutsModalBtn"),Mt=document.getElementById("closeShortcutsModal2Btn");[Tt,Mt].forEach(p=>{p&&p.addEventListener("click",()=>R("shortcutsModal"))})}async function lt(){try{_("Initializing..."),await xt();const t=await $();m.setFunds(t);const e=await Q();m.setGroups(e);const n=await ge(),a=new Map;n.forEach(o=>a.set(o.name,o)),m.setFundNameData(a),m.setFundNames(new Set(n.map(o=>o.name))),Vn(),jn(),Hn(),await G(),A(),console.log("PE Fund Manager initialized successfully")}catch(t){console.error("Error initializing application:",t),A(),g("Error initializing application: "+t.message,"error")}}window.showAddFundModal=Be;window.showManageFundsModal=ye;window.resetFilters=bt;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",lt):lt();</script>
  <style rel="stylesheet" crossorigin>:root{--color-primary: #2C3E50;--color-primary-light: #34495E;--color-background: #ECF0F1;--color-white: #ffffff;--color-action: #3498DB;--color-action-hover: #2980B9;--color-success: #27AE60;--color-success-hover: #229954;--color-danger: #E74C3C;--color-danger-hover: #C0392B;--color-warning: #F39C12;--color-warning-bg: #FEF9E7;--color-secondary: #95A5A6;--color-secondary-hover: #7F8C8D;--color-text: #2C3E50;--color-text-light: #95A5A6;--color-muted: #95A5A6;--color-border: #E0E0E0;--color-border-input: #BDC3C7;--color-hover-bg: #F8F9FA;--color-alt-bg: #FAFAFA;--spacing-xs: 4px;--spacing-sm: 8px;--spacing-md: 12px;--spacing-lg: 20px;--spacing-xl: 30px;--radius-sm: 3px;--radius-md: 4px;--shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);--shadow-md: 0 2px 8px rgba(0, 0, 0, .15);--shadow-lg: 0 4px 12px rgba(0, 0, 0, .15);--transition-fast: all .15s ease;--transition-medium: all .2s ease}[data-theme=dark]{--color-primary: #F0F0F0;--color-primary-light: #2D3748;--color-background: #1A202C;--color-white: #2D3748;--color-action: #63B3ED;--color-action-hover: #4299E1;--color-success: #68D391;--color-success-hover: #48BB78;--color-danger: #FC8181;--color-danger-hover: #F56565;--color-warning: #F6E05E;--color-warning-bg: #744210;--color-secondary: #A0AEC0;--color-secondary-hover: #CBD5E0;--color-text: #F7FAFC;--color-text-light: #CBD5E0;--color-muted: #A0AEC0;--color-border: #4A5568;--color-border-input: #4A5568;--color-hover-bg: #374151;--color-alt-bg: #1F2937;--shadow-sm: 0 1px 3px rgba(0, 0, 0, .3);--shadow-md: 0 2px 8px rgba(0, 0, 0, .4);--shadow-lg: 0 4px 12px rgba(0, 0, 0, .5)}[data-theme=dark] header{background:#1f2937;border-bottom-color:#374151;color:#e2e8f0}[data-theme=dark] header h1{color:#f7fafc}[data-theme=dark] thead{background:#374151}[data-theme=dark] thead th{color:#f7fafc}[data-theme=dark] th:hover{background:#4a5568}[data-theme=dark] td{border-bottom-color:#374151}[data-theme=dark] tbody tr:last-child{border-color:#4a5568;background:#1f2937}[data-theme=dark] .modal-content,[data-theme=dark] .sidebar{background:#2d3748}[data-theme=dark] .sidebar-header{background:#1f2937;border-bottom-color:#4a5568}[data-theme=dark] .status-message{background:#2d3748}[data-theme=dark] .table-tag{background:#374151;color:#e2e8f0}[data-theme=dark] .tag{background:#4299e1}[data-theme=dark] input:disabled,[data-theme=dark] textarea:disabled,[data-theme=dark] select:disabled{background:#1f2937}[data-theme=dark] input,[data-theme=dark] textarea,[data-theme=dark] select,[data-theme=dark] select option,[data-theme=dark] .form-group input,[data-theme=dark] .form-group textarea,[data-theme=dark] .form-group select{background:#2d3748!important;color:#f7fafc!important}[data-theme=dark] input::placeholder,[data-theme=dark] textarea::placeholder{color:#a0aec0}[data-theme=dark] .details-table th{background-color:#374151;border-color:#4a5568}[data-theme=dark] .details-table td{border-color:#4a5568}[data-theme=dark] .details-table tbody tr:nth-child(2n){background-color:#1f2937}[data-theme=dark] .group-item,[data-theme=dark] .fund-name-item{background:#1f2937;border-color:#4a5568;color:#f7fafc}[data-theme=dark] .action-dropdown{background:#2d3748;border-color:#4a5568}[data-theme=dark] .action-dropdown a:hover{background:#374151}[data-theme=dark] .action-dropdown a.danger-action:hover{background:#742a2a}[data-theme=dark] .loading-content{background:#2d3748}[data-theme=dark] .multi-select-trigger{background:#2d3748;border-color:#4a5568;color:#f7fafc}[data-theme=dark] .multi-select-dropdown{background:#2d3748;border-color:#4a5568}[data-theme=dark] .multi-select-option:hover{background:#374151}[data-theme=dark] .multi-select-option.selected{background:#63b3ed33}[data-theme=dark] .multi-select-actions{background:#1f2937;border-top-color:#4a5568}[data-theme=dark] .multi-select-option.group-top-level{background:#374151}[data-theme=dark] .multi-select-option.group-separator{border-top-color:#4a5568}[data-theme=dark] .multi-select-option.group-child{border-left-color:#63b3ed}[data-theme=dark] .multi-select-search{background:var(--color-bg);border-bottom-color:#4a5568}[data-theme=dark] .multi-select-search input{background:#374151;border-color:#4a5568;color:var(--color-text)}[data-theme=dark] .multi-select-search input:focus{border-color:var(--color-action)}.portfolio-summary{display:flex;flex-wrap:wrap;gap:16px;padding:16px 20px;background:var(--color-alt-bg);border:1px solid var(--color-border);border-radius:var(--radius-md);margin-bottom:20px}.summary-stat{display:flex;flex-direction:column;min-width:100px;padding:8px 16px;background:var(--color-white);border-radius:var(--radius-sm);border:1px solid var(--color-border)}.summary-label{font-size:11px;font-weight:600;text-transform:uppercase;color:var(--color-text-light);letter-spacing:.5px;margin-bottom:4px}.summary-value{font-size:18px;font-weight:600;color:var(--color-text);font-variant-numeric:tabular-nums}.summary-value.positive{color:var(--color-success)}.summary-value.negative{color:var(--color-danger)}#detailsSummary{gap:10px}#detailsSummary .summary-value{font-size:13px}#detailsSummary .summary-label{font-size:9px}#detailsSummary .summary-stat{min-width:70px;padding:8px 10px}.summary-label-container{display:flex;align-items:center;gap:4px}.info-icon{display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;border-radius:50%;background:var(--color-text-light);color:var(--color-white);font-size:9px;font-weight:700;cursor:help;position:relative;flex-shrink:0}.info-icon:hover{background:var(--color-action)}.info-icon .tooltip{display:none;position:absolute;bottom:calc(100% + 8px);left:50%;transform:translate(-50%);background:var(--color-primary);color:#fff;padding:8px 12px;border-radius:var(--radius-md);font-size:12px;font-weight:400;white-space:normal;width:220px;text-align:left;z-index:1000;box-shadow:var(--shadow-md);line-height:1.4}.info-icon .tooltip:after{content:"";position:absolute;top:100%;left:50%;transform:translate(-50%);border:6px solid transparent;border-top-color:var(--color-primary)}.info-icon:hover .tooltip{display:block}[data-theme=dark] .info-icon{background:var(--color-text-light);color:var(--color-background)}[data-theme=dark] .info-icon .tooltip{background:#4a5568}[data-theme=dark] .info-icon .tooltip:after{border-top-color:#4a5568}.timeline-panel{background:var(--color-white);border:1px solid var(--color-border);border-radius:var(--radius-md);margin-bottom:20px;overflow:hidden}.timeline-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--color-alt-bg);border-bottom:1px solid var(--color-border);cursor:pointer;user-select:none}.timeline-header:hover{background:var(--color-hover-bg)}.timeline-header h3{margin:0;font-size:14px;font-weight:600;color:var(--color-text);display:flex;align-items:center;gap:8px}.timeline-toggle{font-size:12px;color:var(--color-text-light);transition:transform .2s ease}.timeline-panel.expanded .timeline-toggle{transform:rotate(180deg)}.timeline-content{display:none;padding:16px;overflow-x:auto}.timeline-panel.expanded .timeline-content{display:block}.timeline-table{width:100%;border-collapse:collapse;font-size:13px;min-width:600px}.timeline-table th,.timeline-table td{padding:8px 12px;text-align:right;border:1px solid var(--color-border);white-space:nowrap}.timeline-table th:not(:first-child),.timeline-table td:not(:first-child){min-width:90px;width:90px}.timeline-table th{background:var(--color-alt-bg);font-weight:600;color:var(--color-text)}.timeline-table th:first-child,.timeline-table td:first-child{text-align:left;position:sticky;left:0;background:var(--color-white);z-index:1}.timeline-table th:first-child{background:var(--color-alt-bg)}.timeline-table .year-projected{background:var(--color-alt-bg);font-style:italic}.timeline-table .year-projected th{background:#e8f4fd}[data-theme=dark] .timeline-table .year-projected th{background:#2c4a5e}.timeline-table .year-estimated{background:var(--color-warning-bg);font-style:italic}.timeline-table .year-estimated th{background:var(--color-warning-bg)}.timeline-estimated-indicator{display:inline-block;font-size:10px;color:var(--color-warning);margin-left:4px;vertical-align:super;cursor:help}.timeline-table .row-calls td{color:var(--color-danger)}.timeline-table .row-distributions td,.timeline-table .row-net td.positive{color:var(--color-success)}.timeline-table .row-net td.negative{color:var(--color-danger)}.timeline-table .row-net{font-weight:600;border-top:2px solid var(--color-border)}.timeline-table .row-label{font-weight:500;color:var(--color-text)}.timeline-table td:first-child{font-weight:500}.timeline-divider{border-left:3px solid var(--color-action)!important}.timeline-expand-row{cursor:pointer}.timeline-expand-row:hover{background:var(--color-hover-bg)}.timeline-expand-icon{display:inline-block;width:16px;font-size:10px;color:var(--color-text-light)}.timeline-fund-row{display:none}.timeline-fund-row.visible{display:table-row}.timeline-fund-row td{background:var(--color-alt-bg);font-size:12px}.timeline-fund-row td:first-child{padding-left:28px;background:var(--color-alt-bg)}.timeline-no-data{text-align:center;padding:30px;color:var(--color-text-light);font-style:italic}@media (max-width: 768px){.timeline-table{font-size:11px}.timeline-table th,.timeline-table td{padding:6px 8px}}.shortcuts-modal .modal-content{max-width:500px}.shortcuts-list{display:grid;grid-template-columns:auto 1fr;gap:12px 20px;margin-top:16px}.shortcut-key{display:inline-flex;align-items:center;gap:4px}.shortcut-key kbd{display:inline-block;padding:4px 8px;font-family:monospace;font-size:12px;background:var(--color-alt-bg);border:1px solid var(--color-border);border-radius:var(--radius-sm);box-shadow:0 1px 2px #0000001a}.shortcut-desc{color:var(--color-text);font-size:14px}@media (max-width: 768px){.portfolio-summary{gap:8px;padding:12px}.summary-stat{min-width:80px;padding:6px 10px}.summary-label{font-size:10px}.summary-value{font-size:14px}}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;background:var(--color-background);min-height:100vh;padding:var(--spacing-lg)}.container{max-width:1800px;margin:0 auto;background:var(--color-white);border-radius:var(--radius-md);box-shadow:var(--shadow-sm);overflow:hidden}header{background:var(--color-primary);color:var(--color-white);padding:24px var(--spacing-xl);border-bottom:1px solid var(--color-primary-light)}header h1{font-size:1.75em;font-weight:600;margin-bottom:4px;letter-spacing:-.5px}header p{font-size:.95em;opacity:.85;font-weight:400}.controls-bar{background:var(--color-alt-bg);padding:var(--spacing-lg) var(--spacing-xl);display:flex;gap:16px;flex-wrap:wrap;align-items:flex-end;border-bottom:1px solid var(--color-border)}.control-group{display:flex;flex-direction:column;gap:6px}.control-group label{font-weight:500;font-size:.85em;color:var(--color-text)}.control-group select,.control-group input[type=date],.control-group input[type=text]{padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--color-border-input);border-radius:var(--radius-sm);font-size:14px;min-width:150px;background:var(--color-white);color:var(--color-text)}.control-group select:focus,.control-group input[type=date]:focus,.control-group input[type=text]:focus{outline:none;border-color:var(--color-action);box-shadow:0 0 0 2px #3498db1a}.filter-badge{display:inline-flex;align-items:center;gap:6px;background:var(--color-action);color:#fff;font-size:11px;font-weight:600;padding:3px 8px;border-radius:12px;margin-left:8px;white-space:nowrap}.filter-badge .clear-filters{display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;border-radius:50%;background:#ffffff4d;color:#fff;font-size:10px;cursor:pointer;border:none;padding:0;line-height:1}.filter-badge .clear-filters:hover{background:#ffffff80}.multi-select{position:relative;min-width:150px}.multi-select-trigger{display:flex;align-items:center;justify-content:space-between;padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--color-border-input);border-radius:var(--radius-sm);font-size:14px;background:var(--color-white);color:var(--color-text);cursor:pointer;min-height:36px;gap:8px}.multi-select-trigger:hover{border-color:var(--color-action)}.multi-select.open .multi-select-trigger{border-color:var(--color-action);box-shadow:0 0 0 2px #3498db1a}.multi-select-display{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.multi-select-display .placeholder{color:var(--color-muted)}.multi-select-count{background:var(--color-action);color:#fff;font-size:11px;font-weight:600;padding:2px 6px;border-radius:10px;flex-shrink:0}.multi-select-arrow{flex-shrink:0;transition:transform .2s ease}.multi-select.open .multi-select-arrow{transform:rotate(180deg)}.multi-select-dropdown{position:absolute;top:100%;left:0;min-width:220px;margin-top:4px;background:var(--color-white);border:1px solid var(--color-border);border-radius:var(--radius-sm);box-shadow:var(--shadow-lg);z-index:1000;max-height:400px;overflow-y:auto;display:none}.multi-select.open .multi-select-dropdown{display:block}.multi-select-option{display:flex;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;transition:background .15s ease}.multi-select-option:hover{background:var(--color-alt-bg)}.multi-select-option.selected{background:#3498db1a}.multi-select-option input[type=checkbox]{margin:0;cursor:pointer}.multi-select-option label{flex:1;cursor:pointer;font-size:14px;white-space:nowrap}.multi-select-option.group-option{padding-left:calc(12px + var(--indent-level, 0) * 16px)}.multi-select-option.group-top-level{background:var(--color-alt-bg);font-weight:600}.multi-select-option.group-top-level label{font-weight:600}.multi-select-option.group-separator{margin-top:6px;border-top:1px solid var(--color-border);padding-top:10px}.multi-select-option.group-child{border-left:3px solid var(--color-primary-light, #85c1e9);margin-left:8px;padding-left:calc(12px + var(--indent-level, 0) * 16px - 11px)}.multi-select-actions{display:flex;gap:8px;padding:8px 12px;border-top:1px solid var(--color-border);background:var(--color-alt-bg)}.multi-select-actions button{flex:1;padding:4px 8px;font-size:12px}.multi-select-search{padding:8px;border-bottom:1px solid var(--color-border);position:sticky;top:0;background:var(--color-white);z-index:1}.multi-select-search input{width:100%;padding:6px 10px;border:1px solid var(--color-border-input);border-radius:var(--radius-sm);font-size:13px;background:var(--color-white);color:var(--color-text)}.multi-select-search input:focus{outline:none;border-color:var(--color-action);box-shadow:0 0 0 2px #3498db1a}.multi-select-search input::placeholder{color:var(--color-muted)}.multi-select-options{max-height:350px;overflow-y:auto}.multi-select-option.search-hidden{display:none}.multi-select-no-results{padding:12px;text-align:center;color:var(--color-muted);font-size:13px;display:none}.multi-select-no-results.visible{display:block}button{padding:9px 18px;border:none;border-radius:var(--radius-sm);font-size:14px;font-weight:500;cursor:pointer;transition:var(--transition-fast)}.controls-bar button{margin-top:auto}.btn-primary{background:var(--color-action);color:var(--color-white)}.btn-primary:hover{background:var(--color-action-hover)}.btn-secondary{background:var(--color-secondary);color:var(--color-white)}.btn-secondary:hover{background:var(--color-secondary-hover)}.btn-success{background:var(--color-success);color:var(--color-white)}.btn-success:hover{background:var(--color-success-hover)}.btn-danger{background:var(--color-danger);color:var(--color-white)}.btn-danger:hover{background:var(--color-danger-hover)}.btn-link{background:none;border:none;color:var(--color-action);cursor:pointer;padding:2px 4px;font-size:inherit;text-decoration:underline}.btn-link:hover{color:var(--color-action-hover)}.btn-info{background:var(--color-primary-light);color:var(--color-white)}.btn-info:hover{background:var(--color-primary)}button:disabled{opacity:.5;cursor:not-allowed}button:focus-visible,a:focus-visible,input:focus-visible,select:focus-visible,textarea:focus-visible{outline:2px solid var(--color-action);outline-offset:2px}button:focus:not(:focus-visible),a:focus:not(:focus-visible),input:focus:not(:focus-visible),select:focus:not(:focus-visible){outline:none}.skip-link{position:absolute;top:-40px;left:0;background:var(--color-action);color:#fff;padding:8px;z-index:100000;transition:top .3s}.skip-link:focus{top:0}.sr-announce{position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden}.filter-loading{display:none;align-items:center;gap:8px;padding:8px 12px;color:var(--color-text-light);font-size:13px}.filter-loading.show{display:flex}.filter-loading-spinner{width:16px;height:16px;border:2px solid var(--color-border);border-top-color:var(--color-action);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}tbody tr:focus{outline:2px solid var(--color-action);outline-offset:-2px}tbody tr[tabindex]:hover{background:var(--color-hover-bg)}.btn-icon{background:none;border:none;color:var(--color-text-light);font-size:16px;padding:var(--spacing-xs) var(--spacing-sm);cursor:pointer;transition:var(--transition-fast)}.btn-icon:hover{color:var(--color-primary-light)}.action-dropdown{display:none;position:fixed;background:var(--color-white);border:1px solid var(--color-border);border-radius:var(--radius-md);box-shadow:var(--shadow-lg);min-width:160px;z-index:10000;padding:var(--spacing-xs) 0}.action-dropdown.show{display:block}.action-dropdown a{display:block;padding:10px 16px;color:var(--color-text);text-decoration:none;font-size:14px;transition:var(--transition-fast)}.action-dropdown a:hover{background:var(--color-hover-bg)}.action-dropdown a.danger-action{color:var(--color-danger)}.action-dropdown a.danger-action:hover{background:#ffebee}.dropdown{position:relative;display:inline-block}.dropdown-menu{display:none;position:absolute;top:100%;right:0;background:var(--color-white);border:1px solid var(--color-border);border-radius:var(--radius-sm);box-shadow:var(--shadow-md);min-width:160px;z-index:1000;margin-top:var(--spacing-xs)}.dropdown-menu.show{display:block}.dropdown-menu a{display:block;padding:10px 16px;color:var(--color-text);text-decoration:none;font-size:14px;transition:var(--transition-fast)}.dropdown-menu a:hover{background:var(--color-hover-bg)}.dropdown-menu a:first-child{border-radius:var(--radius-sm) var(--radius-sm) 0 0}.dropdown-menu a:last-child{border-radius:0 0 var(--radius-sm) var(--radius-sm)}.content{padding:var(--spacing-xl)}.table-container{overflow-x:auto;margin-bottom:var(--spacing-xl)}.table-container table,table{width:100%;border-collapse:collapse;background:var(--color-white);border:1px solid var(--color-border);border-radius:var(--radius-sm);overflow:hidden}.table-container table{width:100%;table-layout:auto}thead{background:var(--color-primary-light);color:var(--color-white);position:sticky;top:0;z-index:10}th{padding:14px var(--spacing-md);text-align:left;font-weight:500;cursor:pointer;user-select:none;white-space:nowrap;font-size:.9em}th:hover{background:var(--color-primary)}th.sorted-asc:after{content:" ↑";opacity:1}th.sorted-desc:after{content:" ↓";opacity:1}th.sorted-asc[data-sort-priority="1"]:after{content:" ↑¹"}th.sorted-asc[data-sort-priority="2"]:after{content:" ↑²"}th.sorted-asc[data-sort-priority="3"]:after{content:" ↑³"}th.sorted-asc[data-sort-priority="4"]:after{content:" ↑⁴"}th.sorted-asc[data-sort-priority="5"]:after{content:" ↑⁵"}th.sorted-desc[data-sort-priority="1"]:after{content:" ↓¹"}th.sorted-desc[data-sort-priority="2"]:after{content:" ↓²"}th.sorted-desc[data-sort-priority="3"]:after{content:" ↓³"}th.sorted-desc[data-sort-priority="4"]:after{content:" ↓⁴"}th.sorted-desc[data-sort-priority="5"]:after{content:" ↓⁵"}th.wrap-header{white-space:normal;line-height:1.3;padding:10px 8px}th{position:relative}th.resizable{overflow:hidden;text-overflow:ellipsis}th .resizer{position:absolute;top:0;right:-8px;width:16px;height:100%;cursor:col-resize;user-select:none;z-index:10}th .resizer:hover{background-color:var(--color-action);width:4px;right:0}th.resizing{user-select:none}#fundsTable th:nth-child(2),#fundsTable td:nth-child(2){max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}td{padding:12px;border-bottom:1px solid #F0F0F0;font-size:.9em;color:var(--color-primary)}tbody tr:hover{background:var(--color-hover-bg)}tbody tr:last-child{border-top:2px solid var(--color-primary-light);border-bottom:2px solid var(--color-primary-light);font-weight:600;background:var(--color-alt-bg)}tbody tr:last-child td{border-bottom:none}table.no-summary-row tbody tr:last-child{border-top:none;border-bottom:1px solid var(--color-border);font-weight:400;background:transparent}[data-theme=dark] table.no-summary-row tbody tr:last-child{border-color:var(--color-border);background:transparent}td.number{text-align:right;font-variant-numeric:tabular-nums}th.center,td.center{text-align:center}.positive{color:var(--color-success)}.negative{color:var(--color-danger)}.empty-state{text-align:center;padding:60px 20px;color:var(--color-text-light)}.action-buttons{display:flex;gap:5px;flex-wrap:nowrap}.btn-sm{padding:6px 12px;font-size:12px;min-width:auto;white-space:nowrap}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow-y:auto;background-color:#00000080}.modal.show{display:flex;align-items:flex-start;justify-content:center;padding:40px 20px}.modal-content{background-color:var(--color-white);padding:30px;border-radius:var(--radius-md);width:100%;max-width:700px;box-shadow:0 4px 12px #00000026;position:relative;margin:auto}.modal-content h2{margin-bottom:24px;color:var(--color-primary);font-size:1.5em;font-weight:600}.modal .close{position:absolute;top:15px;right:20px;font-size:28px;font-weight:300;color:var(--color-text-light);cursor:pointer;line-height:1;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);transition:var(--transition-medium)}.modal .close:hover{background:var(--color-border);color:var(--color-primary)}.confirm-modal{z-index:2000}.confirm-modal-content{max-width:450px;text-align:center}.confirm-modal-content h2{margin-bottom:16px}.confirm-modal-message{color:var(--color-text);line-height:1.6;margin-bottom:8px;white-space:pre-wrap}.confirm-modal-content .form-actions{justify-content:center}.confirm-modal-content .form-actions button{flex:0 1 auto;min-width:100px}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:500;color:var(--color-primary);font-size:.9em}.form-group input,.form-group select,.form-group textarea{width:100%;padding:10px 12px;border:1px solid var(--color-border-input);border-radius:var(--radius-sm);font-size:14px;transition:var(--transition-fast);background:var(--color-white)}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--color-action);box-shadow:0 0 0 2px #3498db1a}.form-group.has-error input,.form-group.has-error select,.form-group.has-error textarea{border-color:var(--color-danger);background-color:#e74c3c0d}.form-group.has-error input:focus,.form-group.has-error select:focus,.form-group.has-error textarea:focus{border-color:var(--color-danger);box-shadow:0 0 0 2px #e74c3c1a}.form-group textarea{font-family:Courier New,monospace;resize:vertical;min-height:100px}.form-group .hint{font-size:12px;color:var(--color-secondary-hover);margin-top:5px}.tags-container{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px;min-height:24px}.tag{display:inline-flex;align-items:center;background:var(--color-action);color:var(--color-white);padding:4px 10px;border-radius:12px;font-size:13px;font-weight:500;gap:6px}.tag-remove{cursor:pointer;font-weight:700;font-size:16px;line-height:1;opacity:.8}.tag-remove:hover{opacity:1}.table-tags{display:flex;flex-wrap:wrap;gap:4px}.table-tag{display:inline-block;background:#e8f4f8;color:var(--color-primary);padding:2px 8px;border-radius:10px;font-size:11px;font-weight:500;white-space:nowrap}.form-actions{display:flex;gap:10px;margin-top:25px}.form-actions button{flex:1}.status-message{position:fixed;top:20px;right:20px;padding:14px 45px 14px 20px;border-radius:var(--radius-sm);background:var(--color-white);box-shadow:0 2px 8px #00000026;z-index:2000;animation:slideIn .2s ease;max-width:400px;border-left:3px solid}.status-message.success{border-left-color:var(--color-success)}.status-message.error{border-left-color:var(--color-danger)}.status-message.warning{border-left-color:#f39c12}.status-message .close-status{position:absolute;top:10px;right:12px;font-size:20px;font-weight:300;color:var(--color-text-light);cursor:pointer;line-height:1;background:none;border:none;padding:0}.status-message .close-status:hover{color:var(--color-primary)}@keyframes slideIn{0%{transform:translate(400px);opacity:0}to{transform:translate(0);opacity:1}}.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:none;justify-content:center;align-items:center;z-index:3000}.loading-overlay.show{display:flex}.loading-content{background:var(--color-white);padding:30px 40px;border-radius:5px;text-align:center;box-shadow:0 4px 12px #0000004d}.loading-spinner{border:4px solid #f3f3f3;border-top:4px solid var(--color-action);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto 15px}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loading-text{color:var(--color-primary);font-size:16px;font-weight:500}input[type=file]{display:none}.file-input-label{display:inline-block;padding:9px 18px;background:var(--color-primary-light);color:var(--color-white);border-radius:var(--radius-sm);cursor:pointer;font-weight:500;transition:var(--transition-fast);font-size:14px}.file-input-label:hover{background:var(--color-primary)}input:disabled,textarea:disabled,select:disabled{opacity:.6;background:#f5f5f5;cursor:not-allowed}.details-table-wrapper{overflow-x:auto;margin-top:15px;border:1px solid var(--color-border);border-radius:var(--radius-sm);max-width:100%}.details-table{border-collapse:collapse;font-size:.85em}.details-table th{background-color:var(--color-primary-light);color:var(--color-white);padding:6px 8px;text-align:left;border:1px solid var(--color-primary);font-weight:500;font-size:.85em}.details-table td{padding:4px;border:1px solid var(--color-border)}.details-table tbody tr:nth-child(2n){background-color:var(--color-alt-bg)}.details-table input,.details-table select{padding:6px 8px;border:1px solid var(--color-border-input);border-radius:var(--radius-sm);font-size:1em;box-sizing:border-box}.details-table input[type=number],.details-table input[type=text]{text-align:right;width:90px}.details-table input[type=date]{text-align:left;width:130px}.details-table select{text-align:left;width:115px}.details-table input[type=checkbox]{width:auto}#cashFlowsTable{width:100%}#cashFlowsTable th:nth-child(1),#cashFlowsTable td:nth-child(1){width:150px}#cashFlowsTable th:nth-child(2),#cashFlowsTable td:nth-child(2){width:140px}#cashFlowsTable th:nth-child(3),#cashFlowsTable td:nth-child(3){width:130px}#cashFlowsTable th:nth-child(4),#cashFlowsTable td:nth-child(4){width:160px;text-align:center}#cashFlowsTable th:nth-child(5),#cashFlowsTable td:nth-child(5){width:auto;text-align:right}#navTable{width:100%}#navTable th:nth-child(1),#navTable td:nth-child(1){width:150px}#navTable th:nth-child(2),#navTable td:nth-child(2){width:140px}#navTable th:nth-child(3),#navTable td:nth-child(3){width:auto;text-align:right}.delete-row-btn{background:none;border:none;color:var(--color-danger);font-size:18px;padding:4px 8px;cursor:pointer;transition:var(--transition-fast)}.delete-row-btn:hover{color:var(--color-danger-hover)}.validation-error-row{background-color:#ffebee!important;border-left:3px solid var(--color-danger)}.validation-error-row input{border-color:var(--color-danger)!important}#manageFundNamesModal .fund-name-item{display:flex;justify-content:space-between;align-items:center;padding:10px;margin-bottom:8px;background:var(--color-alt-bg);border:1px solid var(--color-border);border-radius:var(--radius-sm);gap:10px}#manageFundNamesModal .fund-name-item .btn-sm{margin-left:5px}.group-item{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;margin-bottom:4px;background:var(--color-alt-bg);border:1px solid var(--color-border);border-radius:var(--radius-sm)}.group-item.level-0{margin-left:0;font-weight:600}.group-item.level-1{margin-left:20px;font-weight:500}.group-item.level-2{margin-left:40px}.group-item.level-3{margin-left:60px}.group-item-info{flex:1;display:flex;align-items:center;gap:10px}.group-item-type{font-size:.85em;color:var(--color-secondary-hover);font-style:italic}.group-item-actions{display:flex;gap:5px}@media (max-width: 1400px){.controls-bar{flex-direction:column;align-items:stretch}.control-group{width:100%}}@media (max-width: 768px){body{padding:var(--spacing-sm)}header{padding:16px var(--spacing-md)}header h1{font-size:1.4em}.controls-bar{padding:var(--spacing-md);gap:12px}.content{padding:var(--spacing-md)}.table-container{overflow-x:auto;-webkit-overflow-scrolling:touch}.modal-content{padding:20px;margin:20px;max-width:calc(100% - 40px)}.form-actions{flex-direction:column}.form-actions button{width:100%}.sidebar{width:280px;right:-280px}.btn-icon{font-size:18px!important;padding:6px}th,td{font-size:.85em;padding:8px 6px}}@media (max-width: 480px){header h1{font-size:1.2em}header p{font-size:.85em}.controls-bar{gap:8px}.modal-content{padding:15px}.modal-content h2{font-size:1.2em}th,td{font-size:.8em;padding:6px 4px}.table-container table{min-width:800px}}@media print{:root,[data-theme=dark]{--color-primary: #2C3E50;--color-primary-light: #34495E;--color-background: #ECF0F1;--color-white: #ffffff;--color-action: #3498DB;--color-success: #27AE60;--color-danger: #E74C3C;--color-text: #2C3E50;--color-text-light: #95A5A6;--color-muted: #95A5A6;--color-border: #E0E0E0;--color-hover-bg: #F8F9FA;--color-alt-bg: #FAFAFA}body{background:#fff!important;color:#2c3e50!important;padding:0}.container{box-shadow:none;border-radius:0}.controls-bar,.btn-sm,button{display:none!important}header{background:#fff!important;color:#2c3e50!important;border-bottom:2px solid #2C3E50!important;padding:15px}header h1{color:#2c3e50!important}header p{color:#95a5a6!important}.content{padding:10px}table{width:100%;max-width:100%;page-break-inside:auto;border:1px solid var(--color-primary);table-layout:fixed}.table-container table{min-width:100%!important;max-width:100%!important}thead{background:#2c3e50!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}thead th{color:#fff!important;background:#2c3e50!important}tr{page-break-inside:avoid;page-break-after:auto}th,td{padding:8px 6px;font-size:10px;color:#2c3e50!important;background:#fff!important}tbody tr:nth-child(2n) td{background:#f8f9fa!important}.container,.content,.table-container{background:#fff!important}.positive{color:#27ae60!important}.negative{color:#e74c3c!important}#fundsTable th,#fundsTable td{min-width:auto!important;max-width:none!important}#fundsTable th:nth-child(1),#fundsTable td:nth-child(1){width:130px!important}#fundsTable th:nth-child(2),#fundsTable td:nth-child(2){width:90px!important;max-width:90px!important;overflow:hidden;text-overflow:ellipsis}#fundsTable th:nth-child(3),#fundsTable td:nth-child(3){width:45px!important}#fundsTable th:nth-child(4),#fundsTable td:nth-child(4),#fundsTable th:nth-child(5),#fundsTable td:nth-child(5),#fundsTable th:nth-child(6),#fundsTable td:nth-child(6),#fundsTable th:nth-child(7),#fundsTable td:nth-child(7),#fundsTable th:nth-child(8),#fundsTable td:nth-child(8),#fundsTable th:nth-child(11),#fundsTable td:nth-child(11){width:70px!important}#fundsTable th:nth-child(9),#fundsTable td:nth-child(9),#fundsTable th:nth-child(10),#fundsTable td:nth-child(10){width:50px!important}thead tr th:last-child,tbody tr td:last-child{display:none}tbody tr:last-child{border-top:2px solid var(--color-primary);border-bottom:2px solid var(--color-primary);background:#f0f0f0!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.positive{color:var(--color-success)!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}.negative{color:var(--color-danger)!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}@page{size:landscape;margin:.5in}#timelinePanel:not(.expanded){display:none!important}}.sidebar-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:9998;opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}.sidebar-overlay.show{opacity:1;visibility:visible}.sidebar{position:fixed;top:0;right:-320px;width:320px;height:100%;background:var(--color-white);box-shadow:-2px 0 8px #00000026;z-index:9999;transition:right .3s ease;display:flex;flex-direction:column}.sidebar.show{right:0}.sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:1px solid var(--color-border);background:var(--color-hover-bg)}.sidebar-header h3{margin:0;color:var(--color-primary);font-size:18px;font-weight:600}.sidebar-close{background:none;border:none;font-size:28px;color:var(--color-secondary-hover);cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);transition:var(--transition-medium)}.sidebar-close:hover{background:var(--color-border);color:var(--color-primary)}.sidebar-content{flex:1;overflow-y:auto;padding:10px 0}.sidebar-section{margin-bottom:10px}.sidebar-section-title{padding:12px 20px 8px;margin:0;font-size:12px;font-weight:600;color:var(--color-secondary-hover);text-transform:uppercase;letter-spacing:.5px}.sidebar-item{padding:0}.sidebar-item a,.sidebar-import-label{display:flex;align-items:center;gap:12px;padding:12px 20px;color:var(--color-primary);text-decoration:none;transition:var(--transition-medium);cursor:pointer;font-size:14px}.sidebar-item a:hover,.sidebar-import-label:hover{background:var(--color-hover-bg)}.sidebar-checkbox-label{display:flex;align-items:center;gap:12px;padding:12px 20px;cursor:pointer;transition:var(--transition-medium);font-size:14px}.sidebar-checkbox-label:hover{background:var(--color-hover-bg)}.sidebar-checkbox-label input[type=checkbox]{width:18px;height:18px;cursor:pointer;margin:0}.sidebar-checkbox-label span{color:var(--color-primary);flex:1}body.sidebar-open{overflow:hidden}</style>
</head>
<body>
    <!-- Skip to main content for keyboard/screen reader users -->
    <a href="#mainContent" class="skip-link">Skip to main content</a>

    <!-- Screen reader announcements for dynamic content updates -->
    <div id="srAnnounce" class="sr-announce" aria-live="polite" aria-atomic="true"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" role="dialog" aria-labelledby="loadingText" aria-modal="true">
        <div class="loading-content">
            <div class="loading-spinner" aria-hidden="true"></div>
            <div class="loading-text" id="loadingText">Loading...</div>
        </div>
    </div>

    <div class="container" role="main">
        <header role="banner">
            <h1 id="headerTitle">PE Fund Manager</h1>
            <p id="headerSubtitle">Private Equity Fund Analytics & Management Tool</p>
        </header>

        <div class="controls-bar" role="search" aria-label="Filter and search controls">
            <div class="control-group">
                <label>Filter by Group</label>
                <div class="multi-select" id="groupFilter" data-placeholder="All Groups">
                    <div class="multi-select-trigger" tabindex="0" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                        <span class="multi-select-display"><span class="placeholder">All Groups</span></span>
                        <span class="multi-select-arrow">&#9662;</span>
                    </div>
                    <div class="multi-select-dropdown" role="listbox"></div>
                </div>
            </div>
            <div class="control-group">
                <label>Filter by Fund</label>
                <div class="multi-select" id="fundFilter" data-placeholder="All Funds">
                    <div class="multi-select-trigger" tabindex="0" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                        <span class="multi-select-display"><span class="placeholder">All Funds</span></span>
                        <span class="multi-select-arrow">&#9662;</span>
                    </div>
                    <div class="multi-select-dropdown" role="listbox"></div>
                </div>
            </div>
            <div class="control-group">
                <label>Filter by Account</label>
                <div class="multi-select" id="accountFilter" data-placeholder="All Accounts">
                    <div class="multi-select-trigger" tabindex="0" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                        <span class="multi-select-display"><span class="placeholder">All Accounts</span></span>
                        <span class="multi-select-arrow">&#9662;</span>
                    </div>
                    <div class="multi-select-dropdown" role="listbox"></div>
                </div>
            </div>
            <div class="control-group">
                <label>Filter by Vintage</label>
                <div class="multi-select" id="vintageFilter" data-placeholder="All Vintages">
                    <div class="multi-select-trigger" tabindex="0" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                        <span class="multi-select-display"><span class="placeholder">All Vintages</span></span>
                        <span class="multi-select-arrow">&#9662;</span>
                    </div>
                    <div class="multi-select-dropdown" role="listbox"></div>
                </div>
            </div>
            <div class="control-group">
                <label>Filter by Tag</label>
                <div class="multi-select" id="tagFilter" data-placeholder="All Tags">
                    <div class="multi-select-trigger" tabindex="0" role="combobox" aria-expanded="false" aria-haspopup="listbox">
                        <span class="multi-select-display"><span class="placeholder">All Tags</span></span>
                        <span class="multi-select-arrow">&#9662;</span>
                    </div>
                    <div class="multi-select-dropdown" role="listbox"></div>
                </div>
            </div>
            <div class="control-group">
                <label for="cutoffDate" title="Calculate all metrics (IRR, MOIC, NAV, etc.) as of this date">Cutoff Date</label>
                <input type="date" id="cutoffDate" title="Calculate all metrics (IRR, MOIC, NAV, etc.) as of this date" aria-label="Cutoff date for calculating metrics">
            </div>
            <span id="activeFiltersIndicator" class="filter-badge" style="display: none;" aria-live="polite"></span>
            <div id="filterLoading" class="filter-loading" aria-live="polite">
                <div class="filter-loading-spinner" aria-hidden="true"></div>
                <span>Filtering...</span>
            </div>
            <div style="margin-left: auto;">
                <button class="btn-icon" id="toggleSidebarBtn" title="Settings and Actions" aria-label="Open settings sidebar" style="font-size: 20px;">&#9776;</button>
            </div>
        </div>

        <div class="content" id="mainContent">
            <div id="portfolioSummary" class="portfolio-summary">
                <div class="summary-stat">
                    <span class="summary-label">Investments</span>
                    <span class="summary-value" id="summaryInvestmentCount">0</span>
                </div>
                <div class="summary-stat">
                    <span class="summary-label">Funds</span>
                    <span class="summary-value" id="summaryFundCount">0</span>
                </div>
                <div class="summary-stat">
                    <span class="summary-label">Total Commitment</span>
                    <span class="summary-value" id="summaryCommitment">$0</span>
                </div>
                <div class="summary-stat">
                    <span class="summary-label">Total NAV</span>
                    <span class="summary-value" id="summaryNav">$0</span>
                </div>
                <div class="summary-stat">
                    <div class="summary-label-container">
                        <span class="summary-label">Avg IRR</span>
                        <span class="info-icon" aria-label="IRR explanation">?<span class="tooltip">Internal Rate of Return: The annualized return rate that makes the net present value of all cash flows equal to zero. Higher is better.</span></span>
                    </div>
                    <span class="summary-value" id="summaryIRR">N/A</span>
                </div>
                <div class="summary-stat">
                    <div class="summary-label-container">
                        <span class="summary-label">Avg MOIC</span>
                        <span class="info-icon" aria-label="MOIC explanation">?<span class="tooltip">Multiple on Invested Capital: Total value (distributions + NAV) divided by total contributions. A MOIC of 2.0x means you doubled your money.</span></span>
                    </div>
                    <span class="summary-value" id="summaryMOIC">N/A</span>
                </div>
                <div class="summary-stat">
                    <div class="summary-label-container">
                        <span class="summary-label">DPI</span>
                        <span class="info-icon" aria-label="DPI explanation">?<span class="tooltip">Distributions to Paid-In: Total distributions divided by total contributions. Measures actual cash returned to investors.</span></span>
                    </div>
                    <span class="summary-value" id="summaryDPI">N/A</span>
                </div>
                <div class="summary-stat">
                    <div class="summary-label-container">
                        <span class="summary-label">RVPI</span>
                        <span class="info-icon" aria-label="RVPI explanation">?<span class="tooltip">Residual Value to Paid-In: Current NAV divided by total contributions. Represents unrealized value still held in the fund.</span></span>
                    </div>
                    <span class="summary-value" id="summaryRVPI">N/A</span>
                </div>
                <div class="summary-stat">
                    <div class="summary-label-container">
                        <span class="summary-label">TVPI</span>
                        <span class="info-icon" aria-label="TVPI explanation">?<span class="tooltip">Total Value to Paid-In: DPI + RVPI. The most comprehensive measure of fund performance.</span></span>
                    </div>
                    <span class="summary-value" id="summaryTVPI">N/A</span>
                </div>
            </div>

            <div id="timelinePanel" class="timeline-panel">
                <div class="timeline-header" id="timelineHeader">
                    <h3>
                        <span>Cash Flow Timeline</span>
                        <span style="font-weight: normal; font-size: 12px; color: var(--color-text-light);">(Historical + Projected)</span>
                    </h3>
                    <span class="timeline-toggle">&#9660;</span>
                </div>
                <div class="timeline-content">
                    <div id="timelineTableContainer">
                        <p class="timeline-no-data">No investments to display yet.</p>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="fundsTable">
                    <thead>
                        <tr>
                            <th data-sort="fundName">Fund Name</th>
                            <th data-sort="accountNumber" class="center">Investor</th>
                            <th data-sort="vintage" class="center">Vintage</th>
                            <th data-sort="commitment" class="center number">Commitment</th>
                            <th data-sort="totalContributions" class="center number">Contributions</th>
                            <th data-sort="totalDistributions" class="center number">Distributions</th>
                            <th data-sort="nav" class="center number">Value (NAV)</th>
                            <th data-sort="investmentReturn" class="center number wrap-header">Investment<br>Return</th>
                            <th data-sort="moic" class="center number">MOIC</th>
                            <th data-sort="irr" class="center number">IRR</th>
                            <th data-sort="outstandingCommitment" class="center number wrap-header">Outstanding<br>Commitment</th>
                            <th class="center"></th>
                        </tr>
                    </thead>
                    <tbody id="fundsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Fund Add/Edit Modal -->
    <div id="fundModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeFundModalBtn">&times;</span>
            <h2 id="fundModalTitle">Add New Investment</h2>
            <form id="fundForm">
                <input type="hidden" id="fundId">
                <input type="hidden" id="isDuplicate">
                <div class="form-group">
                    <label for="fundName">Fund Name *</label>
                    <select id="fundName" required></select>
                    <div id="newFundNameContainer" style="display: none; margin-top: 8px;">
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="newFundNameInline" placeholder="Enter new fund name" style="flex: 1;">
                            <button type="button" class="btn-primary" id="addNewFundNameBtn" style="padding: 8px 12px; white-space: nowrap;">Add</button>
                            <button type="button" class="btn-secondary" id="cancelNewFundNameBtn" style="padding: 8px 12px;">Cancel</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="accountNumber">Account Number *</label>
                    <input type="text" id="accountNumber" required>
                </div>
                <div class="form-group">
                    <label for="fundGroup">Group (optional)</label>
                    <select id="fundGroup">
                        <option value="">No Group</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="commitment">Commitment (USD) *</label>
                    <input type="text" id="commitment" required placeholder="e.g., 1,000,000">
                </div>
                <div id="duplicateMultiplierContainer" class="form-group" style="display: none;">
                    <label for="duplicateMultiplier">Duplicate Multiplier</label>
                    <input type="number" id="duplicateMultiplier" step="any" value="1">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary" id="saveFundBtn">Save</button>
                    <button type="button" class="btn-secondary" id="cancelFundModalBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Action Dropdown -->
    <div id="actionDropdown" class="action-dropdown">
        <a href="#" id="actionEdit">Edit</a>
        <a href="#" id="actionDuplicate">Duplicate</a>
        <a href="#" id="actionViewDetails">View Details</a>
        <a href="#" id="actionDelete" class="danger-action">Delete</a>
    </div>

    <!-- Manage Fund Names Modal -->
    <div id="manageFundNamesModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeManageFundsModalBtn">&times;</span>
            <h2>Manage Fund Names</h2>
            <div class="form-group">
                <label for="newFundNameInput">Add New Fund Name</label>
                <input type="text" id="newFundNameInput" placeholder="Enter fund name">
            </div>
            <details id="newFundTermsDetails" style="margin-bottom: 15px;">
                <summary style="cursor: pointer; color: var(--color-action); font-size: 13px;">+ Add Fund Terms (optional)</summary>
                <div style="padding: 10px; background: var(--color-alt-bg); border-radius: var(--radius-sm); margin-top: 10px;">
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label for="newFundTermStartDate" style="font-size: 12px;">Investment Term Start Date</label>
                        <input type="date" id="newFundTermStartDate">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="newFundInvestmentTerm" style="font-size: 12px;">Investment Term (years)</label>
                        <input type="number" id="newFundInvestmentTerm" min="1" max="15" step="1" placeholder="e.g., 5">
                    </div>
                </div>
            </details>
            <button class="btn-primary" id="addNewFundNameModalBtn" style="width: 100%;">Add Fund Name</button>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">
            <h3 style="margin-bottom: 15px; color: var(--color-text); font-weight: 600; font-size: 1.1em;">Existing Fund Names</h3>
            <div id="fundNamesList"></div>
            <div class="form-actions">
                <button class="btn-secondary" id="closeManageFundsModal2Btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Fund Name Modal -->
    <div id="editFundNameModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeEditFundNameModalBtn">&times;</span>
            <h2>Edit Fund</h2>
            <input type="hidden" id="editFundNameOriginal" value="">
            <div class="form-group">
                <label for="editFundNameInput">Fund Name</label>
                <input type="text" id="editFundNameInput" placeholder="Enter fund name">
            </div>
            <div class="form-group">
                <label for="editFundTags">Tags (optional)</label>
                <div id="editFundTagsContainer" class="tags-container"></div>
                <input type="text" id="editFundTagsInput" placeholder="Add tag (e.g., Venture Capital, Growth Equity)" list="editFundTagsDatalist">
                <datalist id="editFundTagsDatalist"></datalist>
                <div class="hint">Press Enter to add tags. Click x on a tag to remove it.</div>
            </div>
            <h3 style="margin: 20px 0 15px 0; color: var(--color-text); font-weight: 600; font-size: 1em; border-top: 1px solid var(--color-border); padding-top: 20px;">Fund Terms</h3>
            <div class="form-group">
                <label for="editFundTermStartDate">Investment Term Start Date</label>
                <input type="date" id="editFundTermStartDate">
            </div>
            <div class="form-group">
                <label for="editFundInvestmentTerm">Investment Term (years)</label>
                <input type="number" id="editFundInvestmentTerm" min="1" max="15" step="1" placeholder="e.g., 5">
                <div class="hint">Number of years from term start during which capital can be called</div>
            </div>
            <div class="form-actions">
                <button class="btn-primary" id="saveEditedFundNameBtn">Save Changes</button>
                <button class="btn-secondary" id="cancelEditFundNameBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Manage Groups Modal -->
    <div id="manageGroupsModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" id="closeManageGroupsModal2Btn">&times;</span>
            <h2>Manage Account Groups</h2>
            <input type="hidden" id="editGroupId" value="">
            <h3 id="groupFormTitle" style="margin-bottom: 15px; color: var(--color-text); font-weight: 600; font-size: 1.1em;">Add New Group</h3>
            <div class="form-group">
                <label for="newGroupName">Group Name</label>
                <input type="text" id="newGroupName" placeholder="e.g., John Smith, Smith Family Trust">
                <small style="color: var(--color-text-light); font-size: 0.85em; margin-top: 4px; display: block;">Use groups to organize by account holder or entity</small>
            </div>
            <div class="form-group">
                <label for="newGroupParent">Parent Group (optional)</label>
                <select id="newGroupParent">
                    <option value="">None (Top Level)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="newGroupType">Type (optional)</label>
                <input type="text" id="newGroupType" placeholder="e.g., Client, Trust, Account">
            </div>
            <div style="display: flex; gap: 10px;">
                <button id="saveGroupBtn" class="btn-primary">Add Group</button>
                <button id="cancelEditBtn" class="btn-secondary" style="display: none;">Cancel</button>
            </div>
            <hr style="margin: 20px 0; border: none; border-top: 1px solid var(--color-border);">
            <h3 style="margin-bottom: 15px; color: var(--color-text); font-weight: 600; font-size: 1.1em;">Existing Groups</h3>
            <div id="groupsList" style="max-height: 400px; overflow-y: auto;"></div>
            <div class="form-actions">
                <button class="btn-secondary" id="closeManageGroupsModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" id="closeDetailsModalBtn">&times;</span>
            <h2 id="detailsModalTitle">Fund Details</h2>
            <p id="detailsModalSubtitle" style="margin: 5px 0 0 0; color: var(--color-text-light); font-size: 0.9em;"></p>
            <div id="detailsSummary" class="portfolio-summary" style="margin-top: 20px;">
                <div class="summary-stat"><span class="summary-label">Total Commitment</span><span class="summary-value" id="detailsSummaryCommitment">$0</span></div>
                <div class="summary-stat"><span class="summary-label">Contributions</span><span class="summary-value" id="detailsSummaryContributions">$0</span></div>
                <div class="summary-stat"><span class="summary-label">Distributions</span><span class="summary-value" id="detailsSummaryDistributions">$0</span></div>
                <div class="summary-stat"><span class="summary-label">Current Value</span><span class="summary-value" id="detailsSummaryValue">$0</span></div>
                <div class="summary-stat"><span class="summary-label">Investment Return</span><span class="summary-value" id="detailsSummaryReturn">$0</span></div>
                <div class="summary-stat"><span class="summary-label">Outstanding Commitment</span><span class="summary-value" id="detailsSummaryOutstanding">$0</span></div>
            </div>
            <h3 style="margin-top: 20px; color: var(--color-text); font-weight: 600; font-size: 1.1em;">Cash Flows</h3>
            <div class="details-table-wrapper">
                <table class="details-table" id="cashFlowsTable">
                    <thead><tr><th>Date</th><th class="number">Amount (USD)</th><th class="center">Type</th><th class="center">Affects Commitment?</th><th></th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
            <button type="button" class="btn-primary btn-sm" style="margin-top: 10px;" id="addCashFlowRowBtn">Add Cash Flow</button>
            <h3 style="margin-top: 30px; color: var(--color-text); font-weight: 600; font-size: 1.1em;">Values</h3>
            <div class="details-table-wrapper">
                <table class="details-table" id="navTable">
                    <thead><tr><th>Date</th><th>Amount (USD)</th><th></th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
            <button type="button" class="btn-primary btn-sm" style="margin-top: 10px;" id="addNavRowBtn">Add Value</button>
            <div class="form-actions">
                <button class="btn-primary" id="saveDetailsChangesBtn">Save Changes</button>
                <button class="btn-secondary" id="cancelDetailsModalBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Backup Warning Modal -->
    <div id="backupWarningModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" id="closeBackupWarningBtn">&times;</span>
            <h2 style="color: var(--color-warning); margin-bottom: 15px;">Important: Backup Your Data</h2>
            <p style="line-height: 1.6; margin-bottom: 15px;">Your PE Fund Manager data is stored <strong>locally in your browser</strong>. This means your data could be lost if:</p>
            <ul style="margin: 15px 0 15px 25px; line-height: 1.8;">
                <li>You clear your browser cache or cookies</li>
                <li>You uninstall your browser</li>
                <li>Your computer crashes or is reset</li>
                <li>You switch to a different device</li>
            </ul>
            <p style="line-height: 1.6; margin-bottom: 20px; font-weight: 600; color: var(--color-danger);">Please export your data regularly to avoid data loss!</p>
            <div class="form-group">
                <label><input type="checkbox" id="dontShowBackupWarning" style="margin-right: 8px;">Don't show this warning again</label>
            </div>
            <div class="form-actions">
                <button class="btn-success" id="exportNowBtn">Export Now</button>
                <button class="btn-secondary" id="remindLaterBtn">Remind Me Later</button>
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" class="modal shortcuts-modal">
        <div class="modal-content">
            <span class="close" id="closeShortcutsModalBtn">&times;</span>
            <h2>Keyboard Shortcuts</h2>
            <div class="shortcuts-list">
                <div class="shortcut-key"><kbd>?</kbd></div><div class="shortcut-desc">Show this help</div>
                <div class="shortcut-key"><kbd>Ctrl</kbd> + <kbd>N</kbd></div><div class="shortcut-desc">Add new investment</div>
                <div class="shortcut-key"><kbd>Ctrl</kbd> + <kbd>E</kbd></div><div class="shortcut-desc">Export to JSON</div>
                <div class="shortcut-key"><kbd>Ctrl</kbd> + <kbd>S</kbd></div><div class="shortcut-desc">Save (in details modal)</div>
                <div class="shortcut-key"><kbd>Esc</kbd></div><div class="shortcut-desc">Close modal/sidebar</div>
            </div>
            <div class="form-actions"><button class="btn-secondary" id="closeShortcutsModal2Btn">Close</button></div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal confirm-modal">
        <div class="modal-content confirm-modal-content">
            <h2 id="confirmModalTitle">Confirm</h2>
            <p id="confirmModalMessage" class="confirm-modal-message"></p>
            <div class="form-actions">
                <button class="btn-secondary" id="confirmModalCancelBtn">Cancel</button>
                <button class="btn-danger" id="confirmModalConfirmBtn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Bulk Cash Flow Modal -->
    <div id="bulkCashFlowModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" id="closeBulkCashFlowModalBtn">&times;</span>
            <h2>Bulk Cash Flow</h2>
            <p style="color: var(--color-text-light); margin-bottom: 20px; font-size: 14px;">Add a cash flow to all investors in a fund based on a percentage of their commitment.</p>
            <div class="form-group"><label for="bulkCashFlowFundName">Fund Name *</label><select id="bulkCashFlowFundName" required><option value="">Select a fund</option></select></div>
            <div class="form-group"><label for="bulkCashFlowDate">Date *</label><input type="date" id="bulkCashFlowDate" required></div>
            <div class="form-group"><label for="bulkCashFlowType">Type *</label><select id="bulkCashFlowType" required><option value="Contribution">Contribution (Capital Call)</option><option value="Distribution">Distribution</option><option value="Adjustment">Adjustment</option></select></div>
            <div class="form-group"><label for="bulkCashFlowPercentage">Percentage of Commitment *</label><input type="number" id="bulkCashFlowPercentage" step="0.01" min="0.01" max="100" placeholder="e.g., 4.5" required><div class="hint">Enter percentage (e.g., 4.5 for 4.5%)</div></div>
            <div class="form-group"><label><input type="checkbox" id="bulkCashFlowAffectsCommitment" checked>Affects unfunded commitment</label></div>
            <div id="bulkCashFlowPreview" style="display: none; margin: 20px 0; padding: 15px; background: var(--color-alt-bg); border-radius: var(--radius-sm); max-height: 300px; overflow-y: auto;"><h4 style="margin: 0 0 10px 0; font-size: 14px;">Preview</h4><div id="bulkCashFlowPreviewContent"></div></div>
            <div class="form-actions">
                <button type="button" class="btn-secondary" id="previewBulkCashFlowBtn">Preview</button>
                <button type="button" class="btn-primary" id="applyBulkCashFlowBtn" disabled>Apply</button>
                <button type="button" class="btn-secondary" id="cancelBulkCashFlowBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Bulk Remove Fund Modal -->
    <div id="bulkRemoveFundModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" id="closeBulkRemoveFundModalBtn">&times;</span>
            <h2>Bulk Remove Fund</h2>
            <p style="color: var(--color-text-light); margin-bottom: 20px; font-size: 14px;">Remove all investor positions for a selected fund. This action cannot be undone.</p>
            <div class="form-group"><label for="bulkRemoveFundName">Fund Name *</label><select id="bulkRemoveFundName" required><option value="">Select a fund</option></select></div>
            <div id="bulkRemoveFundPreview" style="display: none; margin: 20px 0; padding: 15px; background: var(--color-alt-bg); border-radius: var(--radius-sm); max-height: 300px; overflow-y: auto;"><h4 style="margin: 0 0 10px 0; font-size: 14px; color: var(--color-danger);">The following investors will be removed:</h4><div id="bulkRemoveFundPreviewContent"></div></div>
            <div class="form-actions">
                <button type="button" class="btn-secondary" id="previewBulkRemoveFundBtn">Preview</button>
                <button type="button" class="btn-danger" id="applyBulkRemoveFundBtn" disabled>Remove All</button>
                <button type="button" class="btn-secondary" id="cancelBulkRemoveFundBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Bulk Assign Group Modal -->
    <div id="bulkAssignGroupModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" id="closeBulkAssignGroupModalBtn">&times;</span>
            <h2>Bulk Assign Group</h2>
            <p style="color: var(--color-text-light); margin-bottom: 20px; font-size: 14px;">Assign all investments with a specific account number to a group.</p>
            <div class="form-group"><label for="bulkAssignGroupAccount">Account Number *</label><select id="bulkAssignGroupAccount" required><option value="">Select an account</option></select></div>
            <div class="form-group"><label for="bulkAssignGroupTarget">Target Group *</label><select id="bulkAssignGroupTarget" required><option value="">No Group</option></select></div>
            <div id="bulkAssignGroupPreview" style="display: none; margin: 20px 0; padding: 15px; background: var(--color-alt-bg); border-radius: var(--radius-sm); max-height: 300px; overflow-y: auto;"><h4 style="margin: 0 0 10px 0; font-size: 14px;">The following investments will be updated:</h4><div id="bulkAssignGroupPreviewContent"></div></div>
            <div class="form-actions">
                <button type="button" class="btn-secondary" id="previewBulkAssignGroupBtn">Preview</button>
                <button type="button" class="btn-primary" id="applyBulkAssignGroupBtn" disabled>Apply</button>
                <button type="button" class="btn-secondary" id="cancelBulkAssignGroupBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Import Preview Modal -->
    <div id="importPreviewModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" id="closeImportPreviewModalBtn">&times;</span>
            <h2>Import Preview</h2>
            <p style="color: var(--color-text-light); margin-bottom: 20px; font-size: 14px;">Review the data to be imported before confirming.</p>
            <div id="importPreviewContent" style="margin: 20px 0; padding: 15px; background: var(--color-alt-bg); border-radius: var(--radius-sm); max-height: 400px; overflow-y: auto;"><p style="color: var(--color-text-light);">Select a JSON file to preview...</p></div>
            <div class="form-actions">
                <label for="importPreviewFileInput" class="btn-secondary" style="cursor: pointer; display: inline-block; padding: 9px 18px; min-width: 100px; text-align: center;">Choose File</label>
                <input type="file" id="importPreviewFileInput" accept=".json" style="display: none;">
                <button type="button" class="btn-primary" id="applyImportBtn" disabled style="min-width: 100px;">Import</button>
                <button type="button" class="btn-secondary" id="cancelImportPreviewBtn" style="min-width: 100px;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Sidebar Panel -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h3>Settings & Actions</h3>
            <button class="sidebar-close" id="closeSidebarBtn" title="Close">&times;</button>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-section">
                <h4 class="sidebar-section-title">View Options</h4>
                <div class="sidebar-item"><label class="sidebar-checkbox-label"><input type="checkbox" id="sidebarShowTagsCheckbox" checked><span>Show Tags</span></label></div>
                <div class="sidebar-item"><label class="sidebar-checkbox-label"><input type="checkbox" id="sidebarDarkModeCheckbox"><span>Dark Mode</span></label></div>
            </div>
            <div class="sidebar-section">
                <h4 class="sidebar-section-title">Manage</h4>
                <div class="sidebar-item"><a href="#" id="sidebarNewInvestment">New Investment</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarManageFunds">Manage Funds</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarManageGroups">Manage Groups</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarBulkCashFlow">Bulk Cash Flow</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarBulkAssignGroup">Bulk Assign Group</a></div>
            </div>
            <div class="sidebar-section">
                <h4 class="sidebar-section-title">Data</h4>
                <div class="sidebar-item"><a href="#" id="sidebarExportCSV">Export to CSV</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarExportJSON">Export to JSON</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarExportPDF">Export to PDF</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarImportJSON">Import JSON</a></div>
            </div>
            <div class="sidebar-section">
                <h4 class="sidebar-section-title">Temporary</h4>
                <div class="sidebar-item"><a href="#" id="sidebarLoadSampleData">Load Sample Data</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarBulkRemoveFund" style="color: var(--color-danger);">Bulk Remove Fund</a></div>
                <div class="sidebar-item"><a href="#" id="sidebarClearDatabase" style="color: var(--color-danger);">Clear Database</a></div>
            </div>
        </div>
    </div>

</body>
</html>
